<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Factu Miral üçí</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <header class="main-header">
        <div class="logo-area">
            <span class="cherry-logo">üçí</span>
            <h1>FACTU <span class="thin">MIRAL</span></h1>
        </div>
        <nav class="main-tabs">
            <button class="tab-btn active" onclick="showTab('factura')">FACTURA</button>
            <button class="tab-btn" onclick="showTab('listado')">HISTORIAL</button>
            <button class="tab-btn" onclick="showTab('conta')">CONTA üîí</button>
            <button class="tab-btn" onclick="showTab('ajustes')">‚öôÔ∏è</button>
        </nav>
    </header>

    <main id="app-content">
        <section id="tab-factura" class="tab-content active">
            <div class="top-bar">
                <button class="btn-pro" onclick="nuevaFactura()">+ NUEVA</button>
                <div id="factura-num-display" style="font-weight:bold">FA-0000</div>
                <button class="btn-pro" onclick="guardarFactura()">GUARDAR</button>
                <button class="btn-pro btn-bw" onclick="exportarPDF()">PDF PRO</button>
                <button class="btn-pro btn-bw" onclick="enviarWhatsApp()">WHATSAPP</button>
            </div>

            <div class="header-grid">
                <div class="card provider-card">
                    <h3>PROVEEDOR</h3>
                    <input type="text" id="p-nom" value="Mohammad Arslan Waris">
                    <input type="text" id="p-nif" value="X6389988J">
                    <input type="text" id="p-dir" value="Calle San Pablo 17, 09003 Burgos">
                    <input type="text" id="p-tel" value="631 667 893">
                </div>
                <div class="qr-container">
                    <div id="qrcode"></div>
                    <small>AEAT QR</small>
                </div>
                <div class="card client-card">
                    <h3>CLIENTE</h3>
                    <select id="cli-select" onchange="seleccionarCliente()"></select>
                    <input type="text" id="c-nom" placeholder="Nombre Fiscal">
                    <input type="text" id="c-nif" placeholder="NIF/CIF">
                    <input type="text" id="c-dir" placeholder="Direcci√≥n">
                </div>
            </div>

            <div class="grid-wrapper">
                <div class="grid-header">
                    <span>PRODUCTO</span><span>MODO</span><span>CANT</span><span>BRUTO</span><span>TARA</span><span>NETO</span><span>PRECIO</span><span>TOTAL</span>
                </div>
                <div id="lineas-factura"></div>
                <div class="grid-footer-btns">
                    <button onclick="agregarLinea()">+ A√±adir L√≠nea</button>
                    <button onclick="reiniciarLineas()">Vaciar Todo</button>
                </div>
            </div>

            <div class="totales-container">
                <div class="obs-box">
                    <textarea id="f-obs" placeholder="Observaciones e informaci√≥n adicional..."></textarea>
                    <div class="tags-box">
                        <input type="text" id="f-tags" placeholder="Tags (ej: San Pablo, Urgente)">
                    </div>
                </div>
                <div class="totales-calculos">
                    <div class="t-row">Subtotal: <span id="res-sub">0.00</span>‚Ç¨</div>
                    <div class="t-row">
                        IVA (4%): <input type="checkbox" id="iva-toggle" checked onchange="calcTotalFinal()"> 
                        <span id="res-iva">0.00</span>‚Ç¨
                    </div>
                    <div class="t-row">
                        Transporte (10%): <input type="checkbox" id="trans-toggle" onchange="calcTotalFinal()"> 
                        <span id="res-trans">0.00</span>‚Ç¨
                    </div>
                    <div class="t-row total-grande">TOTAL: <span id="res-total">0.00</span>‚Ç¨</div>
                    <div class="t-row status-pago">
                        Metodo: 
                        <select id="f-metodo">
                            <option value="Efectivo">Efectivo</option>
                            <option value="Tarjeta">Tarjeta</option>
                            <option value="Transferencia">Transferencia</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-listado" class="tab-content">
            <div class="search-area">
                <input type="text" id="search-input" placeholder="Buscar por cliente o fecha..." onkeyup="renderHistorial()">
            </div>
            <div id="historial-lista"></div>
        </section>

        <section id="tab-conta" class="tab-content">
            <div id="conta-lock">
                <div class="lock-box">
                    <h2>CONTABILIDAD PROTEGIDA</h2>
                    <input type="password" id="pin-input" placeholder="Introduce PIN (8410)">
                    <button onclick="accederConta()">DESBLOQUEAR</button>
                </div>
            </div>
            <div id="conta-panel" style="display:none">
                <div class="tienda-selector">
                    <button onclick="renderConta('Global')">Global</button>
                    <button onclick="renderConta('San Pablo')">San Pablo</button>
                    <button onclick="renderConta('San Lesmes')">San Lesmes</button>
                    <button onclick="renderConta('Santiago')">Santiago</button>
                </div>
                <div class="stats-grid">
                    <div class="s-card">TOTAL<br><strong id="s-total">0‚Ç¨</strong></div>
                    <div class="s-card">EFECTIVO<br><strong id="s-efec">0‚Ç¨</strong></div>
                    <div class="s-card">TARJETA<br><strong id="s-tarj">0‚Ç¨</strong></div>
                </div>
                <div id="reporte-detalle"></div>
            </div>
        </section>
    </main>

    <datalist id="lista-productos"></datalist>
</body>
<script src="app.js"></script>
</html>
