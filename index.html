<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARSLAN PRO V10.4 — KIWI Edition</title>
  <link rel="icon" href="logo-kiwi.png">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#16a34a">

  <!-- Librerías externas -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <img src="logo-kiwi.png" alt="Logo">
      <span>ARSLAN PRO V10.4 — KIWI Edition</span>
    </div>
    <div class="tabs">
      <button class="tab active" data-tab="factura">Factura</button>
      <button class="tab" data-tab="clientes">Clientes</button>
      <button class="tab" data-tab="facturas">Facturas</button>
      <button class="tab" data-tab="productos">Productos</button>
      <button class="tab" data-tab="pendientes">Pendientes</button>
      <button class="tab" data-tab="ventas">Ventas</button>
      <button class="tab" data-tab="resumen">Resumen</button>
    </div>
    <div class="sync-indicator">
      <div class="dot" id="syncDot"></div>
      <span id="syncText">Sync</span>
    </div>
  </div>

  <div class="container">
    <!-- FACTURA -->
    <section class="panel active" data-tab-panel="factura">
      <div class="grid2">
        <div class="card">
          <h3>Datos del proveedor</h3>
          <label>Nombre</label><input id="provNombre">
          <label>NIF</label><input id="provNif">
          <label>Dirección</label><input id="provDir">
          <label>Teléfono</label><input id="provTel">
          <label>Email</label><input id="provEmail">
        </div>

        <div class="card">
          <h3>Datos del cliente</h3>
          <label>Seleccionar</label>
          <select id="selCliente"></select>
          <label>Nombre</label><input id="cliNombre">
          <label>NIF</label><input id="cliNif">
          <label>Dirección</label><input id="cliDir">
          <label>Teléfono</label><input id="cliTel">
          <label>Email</label><input id="cliEmail">
        </div>
      </div>

      <div class="card mt8">
        <h3>Productos</h3>
        <button id="btnAddLinea">+ Añadir línea</button>
        <button class="ghost" id="btnVaciarLineas">Vaciar líneas</button>
        <table class="calc-table mt8">
          <thead>
            <tr>
              <th>Producto</th><th>Modo</th><th>Cant.</th><th>Bruto</th><th>Tara</th><th>Neto</th><th>Precio</th><th>Origen</th><th>Importe</th><th></th>
            </tr>
          </thead>
          <tbody id="lineasBody"></tbody>
        </table>
      </div>

      <div class="grid2">
        <div class="card">
          <h3>Opciones</h3>
          <label class="check"><input type="checkbox" id="chkTransporte"> Transporte (10%)</label>
          <label class="check"><input type="checkbox" id="chkIvaAplicado"> Aplicar IVA (4%)</label>
          <label class="check"><input type="checkbox" id="chkIvaIncluido" checked> Mostrar "IVA incluido"</label>
          <label class="check"><input type="checkbox" id="chkMostrarOrigen" checked> Mostrar origen en PDF</label>
          <label>Estado</label>
          <select id="estado">
            <option value="pendiente">Pendiente</option>
            <option value="parcial">Parcial</option>
            <option value="pagado">Pagado</option>
          </select>
          <label>Método de pago</label>
          <select id="metodoPago">
            <option>Efectivo</option>
            <option>Bizum</option>
            <option>Transferencia</option>
          </select>
          <label>Observaciones</label>
          <textarea id="observaciones" rows="3"></textarea>
        </div>

        <div class="card">
          <h3>Totales</h3>
          <div class="totals-grid">
            <div>Subtotal:</div><div id="subtotal">0,00 €</div>
            <div>Transporte:</div><div id="transp">0,00 €</div>
            <div>IVA:</div><div id="iva">0,00 €</div>
            <div>Total:</div><div class="big" id="total">0,00 €</div>
            <div>Pagado:</div><div><input id="pagado" type="number" step="0.01" placeholder="0.00"></div>
            <div>Pendiente:</div><div class="big" id="pendiente">0,00 €</div>
          </div>

          <h4 class="mt8">Pagos parciales</h4>
          <input id="inpPagoParcial" type="number" step="0.01" placeholder="Importe parcial">
          <button id="btnAddPago">Añadir pago parcial</button>
          <div id="listaPagos" class="list mt8"></div>

          <div class="actions row">
            <button id="btnGuardar">Guardar</button>
            <button class="ghost" id="btnNueva">Nueva</button>
            <button id="btnImprimir">PDF</button>
          </div>
        </div>
      </div>

      <div id="printArea" class="print">
        <div class="pdf-header">
          <div class="pdf-brand"><img src="logo-kiwi.png" alt=""><h2>Factura</h2></div>
          <div class="pdf-meta">
            <div>Nº: <span id="p-num"></span></div>
            <div>Fecha: <span id="p-fecha"></span></div>
          </div>
        </div>
        <hr>
        <div class="grid2">
          <div id="p-prov"></div>
          <div id="p-cli"></div>
        </div>
        <table id="p-tabla" class="calc-table mt8">
          <thead><tr><th>Producto</th><th>Modo</th><th>Cant</th><th>Bruto</th><th>Tara</th><th>Neto</th><th>Precio</th><th>Origen</th><th>Importe</th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="pdf-totales">
          <div>Subtotal: <span id="p-sub"></span><br>Transporte: <span id="p-tra"></span><br>IVA: <span id="p-iva"></span></div>
          <div>Total: <strong id="p-tot"></strong></div>
        </div>
        <canvas id="p-qr"></canvas>
        <div class="pdf-foot">
          <div id="p-estado"></div>
          <div id="p-metodo"></div>
          <div id="p-obs"></div>
          <div id="pdf-foot-note"></div>
        </div>
      </div>
    </section>

    <!-- CLIENTES -->
    <section class="panel" data-tab-panel="clientes">
      <div class="row">
        <input id="buscarCliente" placeholder="Buscar cliente...">
        <button id="btnAddCliente">+ Añadir cliente</button>
      </div>
      <div id="listaClientes" class="list mt8"></div>
    </section>

    <!-- FACTURAS -->
    <section class="panel" data-tab-panel="facturas">
      <div class="row">
        <input id="buscaCliente" placeholder="Filtrar por cliente">
        <select id="filtroEstado">
          <option value="todas">Todas</option>
          <option value="pendiente">Pendiente</option>
          <option value="parcial">Parcial</option>
          <option value="pagado">Pagadas</option>
        </select>
      </div>
      <div id="listaFacturas" class="list mt8"></div>
    </section>

    <!-- PRODUCTOS -->
    <section class="panel" data-tab-panel="productos">
      <div class="row">
        <input id="buscarProducto" placeholder="Buscar producto...">
        <button id="btnAddProducto">+ Añadir producto</button>
      </div>
      <div id="listaProductos" class="list mt8"></div>
    </section>

    <!-- PENDIENTES -->
    <section class="panel" data-tab-panel="pendientes">
      <h3>Deudas pendientes</h3>
      <table class="calc-table">
        <thead><tr><th>Cliente</th><th>Facturas</th><th>Importe</th><th>Última</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="pendiente total">Deuda total: <strong id="resGlobal">0,00 €</strong></div>
      <div class="row actions">
        <button id="btnResetCliente">Reset deudas cliente</button>
        <button class="ghost" id="btnResetGlobal">Reset global</button>
      </div>
    </section>

    <!-- VENTAS -->
    <section class="panel" data-tab-panel="ventas">
      <div class="kpis">
        <div class="kpi"><span>Hoy</span><strong id="vHoy">0,00 €</strong></div>
        <div class="kpi"><span>Semana</span><strong id="vSemana">0,00 €</strong></div>
        <div class="kpi"><span>Mes</span><strong id="vMes">0,00 €</strong></div>
        <div class="kpi"><span>Total</span><strong id="vTotal">0,00 €</strong></div>
      </div>
      <div class="grid2 mt8">
        <canvas id="chartDiario" height="180"></canvas>
        <canvas id="chartMensual" height="180"></canvas>
      </div>
      <div class="mt8"><canvas id="chartTop" height="220"></canvas></div>
      <h3>Ventas por cliente</h3>
      <input id="ventasFiltroMes" type="month">
      <table class="calc-table mt8" id="tblVentasCliente">
        <thead><tr><th>Cliente</th><th>Hoy</th><th>Semana</th><th>Mes</th><th>Total</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- RESUMEN -->
    <section class="panel" data-tab-panel="resumen">
      <h3>Resumen rápido</h3>
      <div class="kpis">
        <div class="kpi"><span>Hoy</span><strong id="rHoy">0,00 €</strong></div>
        <div class="kpi"><span>Semana</span><strong id="rSemana">0,00 €</strong></div>
        <div class="kpi"><span>Mes</span><strong id="rMes">0,00 €</strong></div>
        <div class="kpi"><span>Total</span><strong id="rTotal">0,00 €</strong></div>
      </div>
    </section>
  </div>

  <div id="pricePanel" hidden>
    <div class="pp-title">Historial de precios</div>
    <div id="ppBody"></div>
  </div>

  <datalist id="productNamesList"></datalist>

  <!-- Firebase config (rellena con tus credenciales reales) -->
  <script>
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_DOMINIO.firebaseapp.com",
      databaseURL: "https://TU_DB.firebaseio.com",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_BUCKET.appspot.com",
      messagingSenderId: "TU_SENDER_ID",
      appId: "TU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.database();
  </script>

  <!-- Script principal -->
  <script src="app.js"></script>
</body>
</html>
