<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>FACTU MIRAL ‚Äî B/W PRO</title>

  <!-- Poppins (opcional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Estilos -->
  <link rel="stylesheet" href="./style.css?v=1.0.0" />

  <!-- Libs (CDN) -->
  <!-- QR -->
  <script defer src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <!-- PDF -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <!-- Firebase (opcionales; el app.js debe NO romper si no configuras) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-storage-compat.js"></script>

  <!-- App -->
  <script defer src="./app.js?v=1.0.0"></script>
</head>

<body>
  <!-- TOP BAR -->
  <header class="topbar">
    <div class="brand">
      <!-- Logo cereza B/W (SVG inline) -->
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 64 64" width="34" height="34">
          <path d="M35 10c8 0 14 4 18 11" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
          <path d="M29 12c-4 10-3 18 2 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
          <path d="M45 20c-5 6-8 12-9 20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
          <circle cx="22" cy="44" r="10" fill="none" stroke="currentColor" stroke-width="3"/>
          <circle cx="44" cy="46" r="10" fill="none" stroke="currentColor" stroke-width="3"/>
          <path d="M29 38c-2-2-3-5-3-8" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
          <path d="M38 39c1-7 4-13 8-18" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="brandText">
        <div class="brandTitle">FACTU MIRAL</div>
        <div class="brandSub">B/W PRO ¬∑ Offline primero ¬∑ Cloud opcional</div>
      </div>
    </div>

    <div class="topActions">
      <button class="btn ghost" id="btnQuickSearch" title="Buscar (Ctrl+F)">Buscar</button>
      <button class="btn ghost" id="btnCloudStatus" title="Cloud">Cloud: <span id="cloudBadge" class="badge">OFF</span></button>
      <button class="btn" id="btnNewInvoiceTop" title="Nueva factura">+ Nueva</button>
    </div>
  </header>

  <!-- NAV TABS -->
  <nav class="tabs" role="tablist" aria-label="Secciones">
    <button class="tab active" data-tab="tabFactura" role="tab" aria-selected="true">Factura</button>
    <button class="tab" data-tab="tabFacturas" role="tab">Facturas</button>
    <button class="tab" data-tab="tabClientes" role="tab">Clientes</button>
    <button class="tab" data-tab="tabProductos" role="tab">Productos</button>
    <button class="tab" data-tab="tabTaras" role="tab">Taras</button>
    <button class="tab lock" data-tab="tabContabilidad" role="tab" title="Protegido con PIN">Contabilidad üîí</button>
    <button class="tab" data-tab="tabAjustes" role="tab">Ajustes</button>
    <button class="tab lock" data-tab="tabVentas" role="tab" title="PIN 8410">Ventas diarias üîí</button>
  </nav>

  <!-- MAIN -->
  <main class="main">
    <!-- ===================== -->
    <!-- TAB: FACTURA -->
    <!-- ===================== -->
    <section class="panel active" id="tabFactura" role="tabpanel">

      <!-- HEADER GRID: Proveedor | QR | Cliente -->
      <div class="invoiceHeaderGrid">
        <!-- PROVEEDOR -->
        <div class="card">
          <div class="cardTitleRow">
            <h2>Proveedor</h2>
            <button class="btn ghost sm" id="btnSaveProvider">Guardar</button>
          </div>
          <div class="formGrid">
            <label>Nombre
              <input id="provNombre" type="text" placeholder="Nombre proveedor" />
            </label>
            <label>NIF
              <input id="provNif" type="text" placeholder="NIF" />
            </label>
            <label>Direcci√≥n
              <input id="provDir" type="text" placeholder="Direcci√≥n" />
            </label>
            <label>Tel√©fono
              <input id="provTel" type="text" placeholder="Tel√©fono" />
            </label>
            <label>Email
              <input id="provEmail" type="email" placeholder="Email" />
            </label>
          </div>
        </div>

        <!-- QR AEAT -->
        <div class="card centerCard">
          <div class="cardTitleRow">
            <h2>QR AEAT</h2>
            <button class="btn ghost sm" id="btnCopyQrText">Copiar texto</button>
          </div>

          <div class="qrWrap">
            <canvas id="qrCanvas" width="180" height="180" aria-label="QR"></canvas>
            <div class="smallHint" id="qrSmallText">Texto QR aparecer√° aqu√≠‚Ä¶</div>
          </div>

          <div class="qrRow">
            <button class="btn ghost sm" id="btnRefreshQr">Recalcular</button>
          </div>

          <div class="smallHint">
            * Si falta NIF / N¬∫ / Fecha / Total ‚Üí aviso antes de emitir.
          </div>
        </div>

        <!-- CLIENTE -->
        <div class="card">
          <div class="cardTitleRow">
            <h2>Cliente</h2>
            <div class="row gap">
              <button class="btn ghost sm" id="btnNewClientInline">Nuevo</button>
              <button class="btn ghost sm" id="btnSaveClientInline">Guardar</button>
            </div>
          </div>

          <label>Seleccionar cliente
            <select id="facClienteSelect"></select>
          </label>

          <div class="formGrid">
            <label>Nombre / Raz√≥n social
              <input id="cliNombre" type="text" placeholder="Cliente" />
            </label>
            <label>NIF/CIF
              <input id="cliNif" type="text" placeholder="NIF/CIF" />
            </label>
            <label>Direcci√≥n
              <input id="cliDir" type="text" placeholder="Direcci√≥n" />
            </label>
            <label>Tel√©fono
              <input id="cliTel" type="text" placeholder="Tel√©fono" />
            </label>
            <label>Email
              <input id="cliEmail" type="email" placeholder="Email" />
            </label>
          </div>

          <div class="row gap">
            <label class="chip">
              <input type="checkbox" id="cliIvaIncluido" />
              IVA incluido (sin desglose)
            </label>
            <label class="chip">
              <input type="checkbox" id="cliTransportePorDefecto" />
              Transporte por defecto
            </label>
          </div>

          <label>Notas (cliente)
            <textarea id="cliNotas" rows="2" placeholder="Notas del cliente"></textarea>
          </label>
        </div>
      </div>

      <!-- META FACTURA -->
      <div class="card">
        <div class="metaGrid">
          <div class="metaLeft">
            <div class="kpi">
              <div class="kpiLabel">N¬∫ Factura</div>
              <div class="kpiValue" id="facNumero">FA-‚Äî</div>
            </div>

            <label>Fecha
              <input id="facFecha" type="date" />
              <div class="smallHint">Se guarda ISO, se muestra dd/mm/aaaa en PDF/WhatsApp.</div>
            </label>

            <label>Tags (texto libre)
              <input id="facTags" type="text" placeholder="Ej: San Pablo, reparto, enero‚Ä¶" />
            </label>

            <label>Notas internas (solo sistema)
              <input id="facNotas" type="text" placeholder="Notas internas" />
            </label>
          </div>

          <div class="metaRight">
            <label>Observaciones (se imprimen)
              <textarea id="facObs" rows="4" placeholder="Observaciones / condiciones‚Ä¶"></textarea>
            </label>

            <div class="actionsGrid">
              <button class="btn" id="btnNewInvoice">+ Nueva factura</button>
              <button class="btn ghost" id="btnDuplicateInvoice">Duplicar</button>
              <button class="btn danger" id="btnDeleteInvoice">Eliminar</button>

              <button class="btn" id="btnSaveInvoice">Guardar factura</button>
              <button class="btn" id="btnMakePdf">Generar PDF</button>
              <button class="btn ghost" id="btnViewPdf">Ver PDF</button>
              <button class="btn ghost" id="btnPdfCloud">PDF + Nube</button>
              <button class="btn ghost" id="btnWhatsApp">WhatsApp</button>
            </div>
          </div>
        </div>
      </div>

      <!-- GRID PRO L√çNEAS -->
      <div class="card">
        <div class="cardTitleRow">
          <h2>L√≠neas (GRID PRO)</h2>
          <div class="row gap">
            <button class="btn ghost sm" id="btnAddLine">+ A√±adir l√≠nea</button>
            <button class="btn ghost sm" id="btnClearLines">Vaciar (5 l√≠neas)</button>
          </div>
        </div>

        <div class="gridPro">
          <div class="gridHead">
            <div>Producto</div>
            <div>Modo</div>
            <div>Cant</div>
            <div>Bruto (kg)</div>
            <div>Tara (kg)</div>
            <div>Neto (kg)</div>
            <div>Precio</div>
            <div>Origen</div>
            <div>Importe</div>
            <div></div>
          </div>

          <div id="linesWrap" class="gridBody">
            <!-- filas creadas por app.js -->
          </div>

          <div class="smallHint">
            * Autocomplete manual (no cambia el texto solo). Enter avanza campos; al final crea nueva l√≠nea.
            <br>
            * ‚Äú√öltimos precios‚Äù se muestran solo en pantalla, nunca en PDF.
          </div>
        </div>
      </div>

      <!-- TOTALES / IVA / TRANSPORTE / PAGOS -->
      <div class="totalsGrid">
        <div class="card">
          <div class="cardTitleRow">
            <h2>Totales</h2>
            <div class="row gap">
              <button class="btn ghost sm" id="btnAddIva4">A√±adir 4% IVA</button>
            </div>
          </div>

          <div class="totalsList">
            <div class="totRow"><span>Subtotal</span><strong id="tSubtotal">0,00 ‚Ç¨</strong></div>

            <div class="totRow">
              <label class="chip">
                <input type="checkbox" id="chkTransporte" />
                Transporte
              </label>
              <div class="row gap">
                <span class="muted" id="tTransportePct">10%</span>
                <strong id="tTransporte">0,00 ‚Ç¨</strong>
              </div>
            </div>

            <div class="totRow" id="rowIva">
              <span>IVA</span><strong id="tIva">0,00 ‚Ç¨</strong>
            </div>

            <div class="totRow big">
              <span>TOTAL</span><strong id="tTotal">0,00 ‚Ç¨</strong>
            </div>

            <div class="divider"></div>

            <div class="totRow">
              <span>Pendiente</span><strong id="tPendiente">0,00 ‚Ç¨</strong>
            </div>
          </div>

          <div class="smallHint" id="ivaHint">Modo IVA: desglosado (contabilidad interna). Si ‚ÄúIVA incluido‚Äù ‚Üí no se imprime desglose.</div>
        </div>

        <div class="card">
          <div class="cardTitleRow">
            <h2>Pagos / Estado</h2>
          </div>

          <div class="row gap wrap">
            <label>M√©todo de pago
              <select id="facPagoMetodo">
                <option value="Efectivo">Efectivo</option>
                <option value="Transferencia">Transferencia</option>
                <option value="Tarjeta">Tarjeta</option>
              </select>
            </label>

            <label>Estado
              <select id="facEstado">
                <option value="Impagada">Impagada</option>
                <option value="Parcial">Parcial</option>
                <option value="Pagada">Pagada</option>
              </select>
            </label>
          </div>

          <div class="payBox">
            <div class="row gap">
              <label>Importe
                <input id="pagoImporte" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>
              <label>Fecha
                <input id="pagoFecha" type="date" />
              </label>
              <button class="btn" id="btnAddPago">A√±adir pago</button>
            </div>

            <div id="pagosList" class="list">
              <!-- pagos por app.js -->
            </div>
          </div>

          <div class="smallHint">
            Pendiente = Total ‚àí pagos. Pagos parciales con fecha.
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: FACTURAS -->
    <!-- ===================== -->
    <section class="panel" id="tabFacturas" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Listado de facturas</h2>
          <div class="row gap">
            <input id="invSearch" class="search" type="search" placeholder="Buscar por n¬∫, cliente, tags, fecha‚Ä¶" />
            <button class="btn ghost" id="btnInvExportCsv">Export CSV</button>
          </div>
        </div>

        <div id="invList" class="tableList">
          <!-- filas por app.js -->
        </div>

        <div class="smallHint">
          Click en una factura ‚Üí abre en ‚ÄúFactura‚Äù para editar. Bot√≥n ‚ÄúVer PDF‚Äù abre visor interno.
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: CLIENTES -->
    <!-- ===================== -->
    <section class="panel" id="tabClientes" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Clientes</h2>
          <div class="row gap">
            <input id="cliSearch" class="search" type="search" placeholder="Buscar cliente‚Ä¶" />
            <button class="btn" id="btnCliNew">+ Nuevo</button>
            <button class="btn ghost" id="btnCliSave">Guardar</button>
            <button class="btn danger ghost" id="btnCliDelete">Eliminar</button>
          </div>
        </div>

        <div class="split">
          <div class="left">
            <div id="cliList" class="list">
              <!-- listado por app.js -->
            </div>
          </div>

          <div class="right">
            <div class="formGrid">
              <label>Nombre fiscal
                <input id="cliE_nombre" type="text" />
              </label>
              <label>Alias/comercial
                <input id="cliE_alias" type="text" />
              </label>
              <label>NIF/CIF
                <input id="cliE_nif" type="text" />
              </label>
              <label>Direcci√≥n
                <input id="cliE_dir" type="text" />
              </label>
              <label>Tel√©fono
                <input id="cliE_tel" type="text" />
              </label>
              <label>Email
                <input id="cliE_email" type="email" />
              </label>
              <label>Tags autom√°ticos
                <input id="cliE_tags" type="text" placeholder="Ej: San Pablo, tienda‚Ä¶" />
              </label>
              <label>M√©todo pago por defecto
                <select id="cliE_pago">
                  <option value="">‚Äî</option>
                  <option value="Efectivo">Efectivo</option>
                  <option value="Transferencia">Transferencia</option>
                  <option value="Tarjeta">Tarjeta</option>
                </select>
              </label>

              <div class="row gap wrap">
                <label class="chip">
                  <input type="checkbox" id="cliE_ivaIncl" />
                  IVA incluido por defecto
                </label>
                <label class="chip">
                  <input type="checkbox" id="cliE_transp" />
                  Transporte por defecto
                </label>
              </div>

              <label>Notas
                <textarea id="cliE_notas" rows="4"></textarea>
              </label>
            </div>

            <div class="smallHint">
              * No se permite borrar si el cliente est√° usado en facturas.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: PRODUCTOS -->
    <!-- ===================== -->
    <section class="panel" id="tabProductos" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Productos (Vocabulario + precios + kg/caja + historial)</h2>
          <div class="row gap">
            <input id="prdSearch" class="search" type="search" placeholder="Buscar producto‚Ä¶" />
            <button class="btn" id="btnPrdNew">+ Nuevo</button>
            <button class="btn ghost" id="btnPrdSave">Guardar</button>
            <button class="btn danger ghost" id="btnPrdDelete">Eliminar</button>
          </div>
        </div>

        <div class="split">
          <div class="left">
            <div id="prdList" class="list">
              <!-- listado por app.js -->
            </div>
          </div>

          <div class="right">
            <div class="formGrid">
              <label>Nombre
                <input id="prdE_nombre" type="text" />
              </label>
              <label>Modo por defecto
                <select id="prdE_modo">
                  <option value="kg">kg</option>
                  <option value="caja">caja</option>
                  <option value="ud">ud</option>
                </select>
              </label>
              <label>Kg por caja
                <input id="prdE_kgcaja" type="number" inputmode="decimal" step="0.001" placeholder="Ej: 10" />
              </label>

              <label>Precio ‚Ç¨/kg
                <input id="prdE_pkg" type="number" inputmode="decimal" step="0.01" />
              </label>
              <label>Precio ‚Ç¨/caja
                <input id="prdE_pcaja" type="number" inputmode="decimal" step="0.01" />
              </label>
              <label>Precio ‚Ç¨/ud
                <input id="prdE_pud" type="number" inputmode="decimal" step="0.01" />
              </label>

              <label>Coste (para margen)
                <input id="prdE_coste" type="number" inputmode="decimal" step="0.01" />
              </label>

              <label>Origen por defecto
                <input id="prdE_origen" type="text" placeholder="Ej: Espa√±a" />
              </label>

              <label>Envase/Tara por defecto
                <select id="prdE_tara"></select>
              </label>
            </div>

            <div class="hintBox">
              <strong>Historial (√∫ltimas 5)</strong>
              <div id="prdHist" class="smallHint">‚Äî</div>
              <div class="smallHint">* Solo visible en pantalla, no se imprime.</div>
            </div>

            <div class="smallHint">
              * ‚ÄúGuardar‚Äù guarda modo/origen/kg-caja/precios y envase por defecto.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: TARAS -->
    <!-- ===================== -->
    <section class="panel" id="tabTaras" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Taras (envases/cajas)</h2>
          <div class="row gap">
            <input id="taraSearch" class="search" type="search" placeholder="Buscar tara‚Ä¶" />
            <button class="btn" id="btnTaraNew">+ Nueva</button>
            <button class="btn ghost" id="btnTaraSave">Guardar</button>
            <button class="btn danger ghost" id="btnTaraDelete">Eliminar</button>
          </div>
        </div>

        <div class="split">
          <div class="left">
            <div id="taraList" class="list"></div>
          </div>

          <div class="right">
            <div class="formGrid">
              <label>Nombre
                <input id="taraE_nombre" type="text" placeholder="Ej: Caja pl√°stico ESMO" />
              </label>
              <label>Peso tara por unidad (kg)
                <input id="taraE_peso" type="number" inputmode="decimal" step="0.001" placeholder="Ej: 0.30" />
              </label>
              <label>Notas
                <textarea id="taraE_notas" rows="4" placeholder="Opcional"></textarea>
              </label>
            </div>

            <div class="smallHint">
              En factura: Tara total = n¬∫ envases √ó tara unidad. En modo caja, n¬∫ envases = cantidad por defecto.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: CONTABILIDAD (PIN) -->
    <!-- ===================== -->
    <section class="panel" id="tabContabilidad" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Contabilidad üîí</h2>
          <div class="row gap">
            <button class="btn" id="btnUnlockCont">Desbloquear</button>
            <button class="btn ghost" id="btnLockCont">Bloquear</button>
            <button class="btn ghost" id="btnContExportCsv">Export CSV</button>
          </div>
        </div>

        <div id="contLockedBox" class="lockedBox">
          <div class="lockedMsg">Introduce el PIN para ver contabilidad.</div>
        </div>

        <div id="contContent" class="hidden">
          <div class="row gap wrap">
            <label>Desde
              <input id="contDesde" type="date" />
            </label>
            <label>Hasta
              <input id="contHasta" type="date" />
            </label>
            <label>Cliente
              <select id="contCliente"></select>
            </label>
            <label>Tag
              <input id="contTag" type="text" placeholder="Ej: San Pablo" />
            </label>
            <button class="btn" id="btnContApply">Aplicar</button>
          </div>

          <div class="kpiRow">
            <div class="kpiBox"><div class="kpiLabel">Ventas</div><div class="kpiValue" id="kpiVentas">0,00 ‚Ç¨</div></div>
            <div class="kpiBox"><div class="kpiLabel">IVA</div><div class="kpiValue" id="kpiIva">0,00 ‚Ç¨</div></div>
            <div class="kpiBox"><div class="kpiLabel">N¬∫ facturas</div><div class="kpiValue" id="kpiCount">0</div></div>
            <div class="kpiBox"><div class="kpiLabel">Margen</div><div class="kpiValue" id="kpiMargen">‚Äî</div></div>
          </div>

          <div id="contTable" class="tableList"></div>

          <div class="smallHint">
            * Dashboard mensual, top clientes/productos y pendientes se a√±ade en app.js (Parte 3).
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: AJUSTES -->
    <!-- ===================== -->
    <section class="panel" id="tabAjustes" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Ajustes</h2>
          <div class="row gap">
            <button class="btn ghost" id="btnSaveSettings">Guardar ajustes</button>
            <button class="btn ghost" id="btnResetLocal">Reset local (sin borrar vocabulario)</button>
          </div>
        </div>

        <div class="formGrid">
          <label>PIN Contabilidad
            <input id="setPinCont" type="password" inputmode="numeric" placeholder="PIN contabilidad" />
          </label>

          <label>IVA (%)
            <input id="setIvaPct" type="number" inputmode="decimal" step="0.01" />
          </label>

          <label>Transporte (%)
            <input id="setTranspPct" type="number" inputmode="decimal" step="0.01" />
          </label>

          <label>Plantilla QR AEAT (base)
            <textarea id="setQrBase" rows="4" placeholder="Se usar√° para generar el texto QR."></textarea>
            <div class="smallHint">Incluye campos: {NIF},{NUM},{FECHA},{TOTAL}</div>
          </label>
        </div>

        <div class="divider"></div>

        <h3>Cloud (Firebase) ‚Äî opcional</h3>
        <div class="smallHint">Si no configuras, debe funcionar en local sin errores (0 crash).</div>

        <div class="formGrid">
          <label>apiKey
            <input id="fb_apiKey" type="text" />
          </label>
          <label>authDomain
            <input id="fb_authDomain" type="text" />
          </label>
          <label>databaseURL
            <input id="fb_databaseURL" type="text" />
          </label>
          <label>projectId
            <input id="fb_projectId" type="text" />
          </label>
          <label>storageBucket
            <input id="fb_storageBucket" type="text" />
          </label>
          <label>appId
            <input id="fb_appId" type="text" />
          </label>
        </div>

        <div class="row gap wrap">
          <button class="btn" id="btnCloudInit">Conectar Cloud</button>
          <button class="btn ghost" id="btnCloudLogin">Login</button>
          <button class="btn ghost" id="btnCloudLogout">Salir</button>
          <button class="btn ghost" id="btnCloudSync">Sync ahora</button>
        </div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- TAB: VENTAS DIARIAS (PIN 8410) -->
    <!-- ===================== -->
    <section class="panel" id="tabVentas" role="tabpanel">
      <div class="card">
        <div class="cardTitleRow">
          <h2>Ventas diarias üîí (PIN 8410)</h2>
          <div class="row gap">
            <button class="btn" id="btnUnlockVentas">Desbloquear</button>
            <button class="btn ghost" id="btnLockVentas">Bloquear</button>
            <button class="btn ghost" id="btnVentasExportCsv">Export CSV</button>
          </div>
        </div>

        <div id="ventasLockedBox" class="lockedBox">
          <div class="lockedMsg">Introduce el PIN 8410 para ver/editar ventas.</div>
        </div>

        <div id="ventasContent" class="hidden">
          <div class="row gap wrap">
            <label>Fecha
              <input id="venFecha" type="date" />
            </label>
            <label>Tienda
              <select id="venTienda">
                <option value="San Pablo">San Pablo</option>
                <option value="San Lesmes">San Lesmes</option>
                <option value="Santiago">Santiago</option>
              </select>
            </label>
            <label>Efectivo
              <input id="venEfectivo" type="number" inputmode="decimal" step="0.01" />
            </label>
            <label>Tarjeta
              <input id="venTarjeta" type="number" inputmode="decimal" step="0.01" />
            </label>
            <label>Gastos
              <input id="venGastos" type="number" inputmode="decimal" step="0.01" />
            </label>
            <button class="btn" id="btnVenSave">Guardar</button>
          </div>

          <div class="kpiRow">
            <div class="kpiBox"><div class="kpiLabel">D√≠a semana</div><div class="kpiValue" id="venDiaSemana">‚Äî</div></div>
            <div class="kpiBox"><div class="kpiLabel">Total ventas</div><div class="kpiValue" id="venTotal">0,00 ‚Ç¨</div></div>
            <div class="kpiBox"><div class="kpiLabel">Neto (ventas - gastos)</div><div class="kpiValue" id="venNeto">0,00 ‚Ç¨</div></div>
          </div>

          <div class="row gap wrap">
            <input id="venSearch" class="search" type="search" placeholder="Buscar por fecha/tienda‚Ä¶" />
            <button class="btn ghost" id="btnVenClear">Limpiar filtros</button>
          </div>

          <div id="ventasList" class="tableList"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL: PIN -->
  <div class="modal hidden" id="pinModal" role="dialog" aria-modal="true" aria-labelledby="pinTitle">
    <div class="modalCard">
      <div class="modalHead">
        <h3 id="pinTitle">PIN</h3>
        <button class="iconBtn" id="pinClose" aria-label="Cerrar">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="smallHint" id="pinText">Introduce el PIN</div>
        <input id="pinInput" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="PIN" />
        <div class="row gap">
          <button class="btn" id="pinOk">OK</button>
          <button class="btn ghost" id="pinCancel">Cancelar</button>
        </div>
        <div class="error hidden" id="pinError">PIN incorrecto</div>
      </div>
    </div>
  </div>

  <!-- MODAL: PDF VIEWER -->
  <div class="modal hidden" id="pdfModal" role="dialog" aria-modal="true" aria-labelledby="pdfTitle">
    <div class="modalCard wide">
      <div class="modalHead">
        <h3 id="pdfTitle">Visor PDF</h3>
        <div class="row gap">
          <button class="btn ghost sm" id="pdfPrint">Imprimir</button>
          <button class="btn ghost sm" id="pdfOpenTab">Abrir pesta√±a</button>
          <button class="btn sm" id="pdfClose">Cerrar</button>
        </div>
      </div>
      <div class="modalBody">
        <iframe id="pdfFrame" title="PDF" class="pdfFrame"></iframe>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast hidden"></div>

  <!-- QUICK SEARCH MODAL (simple) -->
  <div class="modal hidden" id="searchModal" role="dialog" aria-modal="true" aria-labelledby="searchTitle">
    <div class="modalCard">
      <div class="modalHead">
        <h3 id="searchTitle">Buscar</h3>
        <button class="iconBtn" id="searchClose" aria-label="Cerrar">‚úï</button>
      </div>
      <div class="modalBody">
        <input id="globalSearch" class="search" type="search" placeholder="Factura, cliente, producto, tag‚Ä¶" />
        <div class="smallHint">Tip: Ctrl+S guardar factura ¬∑ Ctrl+P PDF ¬∑ Ctrl+F buscar</div>
        <div id="globalResults" class="list"></div>
      </div>
    </div>
  </div>

</body>
</html>
