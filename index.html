<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARSLAN PRO V10.5 ‚Äî KIWI Edition</title>
  <link rel="icon" href="logo-kiwi.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <!-- Chart.js, html2pdf y QRCode -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyC5w6I_hK3f-Nz0Mp09Or3VESmaD_c5dm0",
      authDomain: "arslan-pro-kiwi.firebaseapp.com",
      databaseURL: "https://arslan-pro-kiwi-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "arslan-pro-kiwi",
      storageBucket: "arslan-pro-kiwi.firebasestorage.app",
      messagingSenderId: "768704045481",
      appId: "1:768704045481:web:fd32234c8f6a79aa22f8c7"
    };
    const app = initializeApp(firebaseConfig);
    window.db = getDatabase(app);
  </script>
</head>

<body>
  <!-- üîù TOPBAR -->
  <header class="topbar">
    <div class="brand">
      <img src="logo-kiwi.png" alt="Kiwi Logo" />
      <span>ARSLAN PRO KIWI Edition V10.5</span>
    </div>
    <div class="sync-indicator">
      <div id="syncDot" class="dot"></div>
      <span id="syncText">Offline</span>
    </div>
  </header>

  <!-- üîΩ NAV TABS -->
  <nav class="tabs">
    <button class="tab active" data-tab="factura">Factura</button>
    <button class="tab" data-tab="clientes">Clientes</button>
    <button class="tab" data-tab="productos">Productos</button>
    <button class="tab" data-tab="facturas">Historial</button>
    <button class="tab" data-tab="pendientes">Pendientes</button>
    <button class="tab" data-tab="ventas">Ventas</button>
    <button class="tab" data-tab="resumen">Resumen</button>
  </nav>

  <main class="container">

  <!-- üßæ PANEL FACTURA -->
  <section class="panel active" data-tab-panel="factura">
    <div class="grid2">
      <div class="card">
        <h3>Proveedor</h3>
        <input id="provNombre" placeholder="Nombre proveedor" />
        <input id="provNif" placeholder="NIF" />
        <input id="provDir" placeholder="Direcci√≥n" />
        <input id="provTel" placeholder="Tel√©fono" />
        <input id="provEmail" placeholder="Email" />
      </div>
      <div class="card">
        <h3>Cliente</h3>
        <select id="selCliente"></select>
        <input id="cliNombre" placeholder="Nombre cliente" />
        <input id="cliNif" placeholder="NIF" />
        <input id="cliDir" placeholder="Direcci√≥n" />
        <input id="cliTel" placeholder="Tel√©fono" />
        <input id="cliEmail" placeholder="Email" />
      </div>
    </div>

    <div class="mt8">
      <button id="btnAddLinea">‚ûï A√±adir l√≠nea</button>
      <button id="btnVaciarLineas" class="ghost">Vaciar</button>
      <datalist id="productNamesList"></datalist>
    </div>

    <div class="table-wrap mt8">
      <table class="calc-table">
        <thead>
          <tr>
            <th>Producto</th><th>Modo</th><th>Cant</th><th>Bruto</th><th>Tara</th>
            <th>Neto</th><th>Precio</th><th>Origen</th><th>Importe</th><th></th>
          </tr>
        </thead>
        <tbody id="lineasBody"></tbody>
      </table>
    </div>

    <div class="grid2 mt8">
      <div>
        <label class="check"><input type="checkbox" id="chkTransporte" /> + 10 % Transporte</label>
        <label class="check"><input type="checkbox" id="chkIvaAplicado" /> Aplicar IVA 4 %</label>
        <label class="check"><input type="checkbox" id="chkIvaIncluido" checked /> IVA incluido en precios</label>

        <div class="mt8">
          <label>Pagos parciales:</label>
          <div class="row">
            <input id="inpPagoParcial" type="number" step="0.01" placeholder="Importe ‚Ç¨" />
            <button id="btnAddPago">Agregar</button>
          </div>
          <div id="listaPagos" class="list mt8"></div>
        </div>

        <label class="mt8">Pagado total (‚Ç¨):</label>
        <input id="pagado" type="number" step="0.01" placeholder="0,00" />
        <label class="mt8">M√©todo de pago:</label>
        <select id="metodoPago">
          <option>Efectivo</option>
          <option>Tarjeta</option>
          <option>Transferencia</option>
        </select>
        <label class="mt8">Observaciones:</label>
        <textarea id="observaciones" rows="3"></textarea>
      </div>

      <div>
        <h3>Totales</h3>
        <div class="totals-grid">
          <div>Subtotal:</div><div id="subtotal" class="text-right">0,00 ‚Ç¨</div>
          <div>Transporte:</div><div id="transp" class="text-right">0,00 ‚Ç¨</div>
          <div>IVA (4 %):</div><div id="iva" class="text-right">0,00 ‚Ç¨</div>
          <div class="big">TOTAL:</div><div id="total" class="text-right big">0,00 ‚Ç¨</div>
          <div>Pendiente:</div><div id="pendiente" class="text-right">0,00 ‚Ç¨</div>
        </div>

        <label class="mt8">Estado:</label>
        <select id="estado">
          <option value="pendiente">Pendiente</option>
          <option value="parcial">Parcial</option>
          <option value="pagado">Pagado</option>
        </select>

        <div class="actions row">
          <button id="btnGuardar">üíæ Guardar</button>
          <button id="btnNueva" class="ghost">üßæ Nueva</button>
          <button id="btnImprimir">üñ®Ô∏è PDF</button>
        </div>
      </div>
    </div>

    <!-- üñ®Ô∏è PREVIEW FACTURA -->
    <div id="printArea" class="print">
      <div class="pdf-header">
        <div class="pdf-brand">
          <img src="logo-kiwi.png" alt="Kiwi Logo" />
          <h2>Factura Kiwi</h2>
        </div>
        <div class="pdf-meta">
          <div><strong>N¬∫ Factura:</strong> <span id="p-num">(Sin guardar)</span></div>
          <div><strong>Fecha:</strong> <span id="p-fecha"></span></div>
        </div>
      </div>

      <div id="p-prov"></div><hr />
      <div id="p-cli"></div>

      <table id="p-tabla">
        <thead>
          <tr>
            <th>Producto</th><th>Modo</th><th>Cant</th><th>Bruto</th><th>Tara</th>
            <th>Neto</th><th>Precio</th><th>Origen</th><th>Importe</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="pdf-totales">
        <div>
          Subtotal: <span id="p-sub"></span><br />
          Transporte: <span id="p-tra"></span><br />
          IVA: <span id="p-iva"></span>
        </div>
        <div class="big">TOTAL: <span id="p-tot"></span></div>
      </div>

      <div class="pdf-totales">
        <div>Estado: <span id="p-estado"></span></div>
        <div>M√©todo: <span id="p-metodo"></span></div>
      </div>
      <div id="p-obs"></div>
      <div class="pdf-foot"><span id="pdf-foot-note">IVA incluido en los precios.</span></div>
      <canvas id="p-qr"></canvas>
    </div>
  </section>

  <!-- üë• CLIENTES -->
  <section class="panel" data-tab-panel="clientes">
    <div class="row">
      <input id="buscarCliente" placeholder="Buscar cliente..." />
      <button id="btnAddCliente">‚ûï Nuevo</button>
    </div>
    <div id="listaClientes" class="list mt8"></div>
  </section>

  <!-- üçé PRODUCTOS -->
  <section class="panel" data-tab-panel="productos">
    <div class="row">
      <input id="buscarProducto" placeholder="Buscar producto..." />
      <button id="btnAddProducto">‚ûï Nuevo</button>
    </div>
    <div id="listaProductos" class="listaProductos mt8"></div>
  </section>

  <!-- üìö FACTURAS -->
  <section class="panel" data-tab-panel="facturas">
    <div class="row">
      <input id="buscaCliente" placeholder="Buscar cliente..." />
      <select id="filtroEstado">
        <option value="todas">Todas</option>
        <option value="pendiente">Pendientes</option>
        <option value="parcial">Parciales</option>
        <option value="pagado">Pagadas</option>
      </select>
    </div>
    <div id="listaFacturas" class="list mt8"></div>
  </section>

  <!-- ‚è≥ PENDIENTES -->
  <section class="panel" data-tab-panel="pendientes">
    <table id="tblPendientes" class="calc-table">
      <thead>
        <tr><th>Cliente</th><th>Facturas</th><th>Pendiente</th><th>√öltima</th><th></th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="pendiente total mt8">Total global: <span id="resGlobal">0 ‚Ç¨</span></div>
  </section>

  <!-- üìà VENTAS -->
  <section class="panel" data-tab-panel="ventas">
    <div class="kpis">
      <div class="kpi"><span>Hoy</span><strong id="vHoy">0 ‚Ç¨</strong></div>
      <div class="kpi"><span>Semana</span><strong id="vSemana">0 ‚Ç¨</strong></div>
      <div class="kpi"><span>Mes</span><strong id="vMes">0 ‚Ç¨</strong></div>
      <div class="kpi"><span>Total</span><strong id="vTotal">0 ‚Ç¨</strong></div>
    </div>
    <canvas id="chartDiario" height="160"></canvas>
    <canvas id="chartMensual" height="160"></canvas>
    <canvas id="chartTop" height="200"></canvas>
  </section>

  <!-- üìä RESUMEN -->
  <section class="panel" data-tab-panel="resumen">
    <div class="kpis">
      <div class="kpi"><span>Hoy</span><strong id="rHoy">0 ‚Ç¨</strong></div>
      <div class="kpi"><span>Semana</span><strong id="rSemana">0 ‚Ç¨</strong></div>
      <div class="kpi"><span>Mes</span><strong id="rMes">0 ‚Ç¨</strong></div>
      <div class="kpi"><span>Total</span><strong id="rTotal">0 ‚Ç¨</strong></div>
    </div>
    <table id="tblVentasCliente" class="calc-table mt8">
      <thead>
        <tr><th>Cliente</th><th>Hoy</th><th>Semana</th><th>Mes</th><th>Total</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  </main>

  <!-- üì¶ PRICE PANEL -->
  <div id="pricePanel" hidden>
    <div class="pp-title">Historial de precio</div>
    <div id="ppBody"></div>
  </div>

  <!-- üìú APP SCRIPT -->
  <script src="app.js"></script>
</body>
</html>
