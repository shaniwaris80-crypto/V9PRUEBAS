<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Factu Miral PRO</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./src/styles/style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
</head>

<body>
  <div id="app" class="app-container">
    <!-- HEADER -->
    <header class="main-header">
      <div class="brand">
        <div class="logo-circle">üçí</div>
        <div class="brand-text">
          <h1>FACTU MIRAL</h1>
          <span class="badge-pro">PRO WRK.</span>
        </div>
      </div>
      <div class="header-tools">
        <span id="offline-badge" class="badge-offline hidden">OFFLINE</span>
        <span id="date-display" class="date-display">--/--/----</span>
      </div>
    </header>

    <!-- NAVIGATION -->
    <nav class="main-nav">
      <button class="nav-btn active" data-tab="invoice">FACTURA</button>
      <button class="nav-btn" data-tab="invoices">FACTURAS</button>
      <button class="nav-btn" data-tab="clients">CLIENTES</button>
      <button class="nav-btn" data-tab="products">PRODUCTOS</button>
      <button class="nav-btn" data-tab="tares">TARAS</button>
      <button class="nav-btn lock-protected" data-tab="accounting">CONTABILIDAD üîí</button>
      <button class="nav-btn lock-protected" data-tab="sales">VENTAS DIARIAS üîí</button>
      <button class="nav-btn" data-tab="settings">AJUSTES</button>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main id="main-content">

      <!-- 1. PANEL FACTURA (Principal) -->
      <section id="tab-invoice" class="panel active">
        <div class="invoice-workspace">
          <!-- Cabecera Factura -->
          <div class="invoice-header-grid">
            <div class="box-provider">
              <label>PROVEEDOR</label>
              <div class="editable-field" id="provider-info" contenteditable="true">
                <strong>Mohammad Arslan Waris</strong><br>
                NIF: X6389988J<br>
                Calle San Pablo 17, 09003 Burgos<br>
                Tlf: 631 667 893
              </div>
            </div>
            <div class="box-meta">
              <div class="meta-row">
                <label>SERIE/N¬∫</label>
                <input type="text" id="inv-series" value="FA-2026-" class="input-code">
              </div>
              <div class="meta-row">
                <label>FECHA</label>
                <input type="date" id="inv-date">
              </div>
              <div class="qr-preview-box" id="qr-preview-box">
                <canvas id="qr-canvas"></canvas>
                <span class="qr-label">QR TRIBUTARIO</span>
              </div>
            </div>
            <div class="box-client">
              <label>CLIENTE <button class="btn-xs" id="btn-select-client">Seleccionar</button></label>
              <div class="editable-field" id="client-info">
                <span class="placeholder">Seleccione un cliente...</span>
              </div>
              <input type="hidden" id="inv-client-id">
            </div>
          </div>

          <!-- GRID PRO DE L√çNEAS -->
          <div class="invoice-grid-container">
            <table class="grid-table" id="lines-table">
              <thead>
                <tr>
                  <th style="width: 30%">PRODUCTO</th>
                  <th style="width: 8%">MODO</th>
                  <th style="width: 8%">CANT</th>
                  <th style="width: 8%">BRUTO</th>
                  <th style="width: 10%">TARA/ENV</th>
                  <th style="width: 8%">NETO</th>
                  <th style="width: 8%">PRECIO</th>
                  <th style="width: 10%">ORIGEN</th>
                  <th style="width: 10%">IMPORTE</th>
                  <th style="width: 5%">‚ùå</th>
                </tr>
              </thead>
              <tbody id="lines-body">
                <!-- Las l√≠neas se generan por JS -->
              </tbody>
            </table>
            <div class="grid-actions">
              <button class="btn-secondary" id="btn-add-line">+ A√ëADIR L√çNEA</button>
              <button class="btn-text" id="btn-clear-lines">Vaciar</button>
            </div>
          </div>

          <!-- PIE Y TOTALES -->
          <div class="invoice-footer-grid">
            <div class="footer-notes">
              <label>OBSERVACIONES / NOTAS</label>
              <textarea id="inv-notes" rows="3"></textarea>
              <div class="tags-input-container">
                <label>TAGS:</label>
                <input type="text" id="inv-tags" placeholder="Etiquetas (separar por coma)...">
              </div>
            </div>
            <div class="footer-totals">
              <div class="total-row"><span>SUBTOTAL</span> <span id="val-subtotal">0.00 ‚Ç¨</span></div>
              <div class="total-row"><label><input type="checkbox" id="chk-transport"> TRANSPORTE (10%)</label> <span
                  id="val-transport">0.00 ‚Ç¨</span></div>
              <div class="total-row"><label><input type="checkbox" id="chk-iva-included"> IVA INCLUIDO</label> <span
                  id="val-iva-label">IVA (4%)</span> <span id="val-iva">0.00 ‚Ç¨</span></div>
              <div class="total-row big"><span>TOTAL</span> <span id="val-total">0.00 ‚Ç¨</span></div>
            </div>
          </div>

          <!-- BOTONES ACCI√ìN -->
          <div class="invoice-toolbar">
            <button class="btn-primary" id="btn-save-invoice">üíæ GUARDAR</button>
            <button class="btn-secondary" id="btn-print-pdf">üñ®Ô∏è PDF</button>
            <button class="btn-whatsapp" id="btn-whatsapp">üì± WHATSAPP</button>
            <button class="btn-danger" id="btn-reset-invoice">üóëÔ∏è NUEVA</button>
          </div>
        </div>
      </section>

      <!-- 2. CLIENTES -->
      <section id="tab-clients" class="panel hidden">
        <div class="panel-header">
          <h2>Gesti√≥n de Clientes</h2>
          <button class="btn-primary" id="btn-new-client">+ Nuevo Cliente</button>
        </div>
        <div class="search-bar">
          <input type="text" id="search-clients" placeholder="Buscar cliente por nombre, nif..." class="input-search">
        </div>
        <div class="list-container" id="list-clients">
          <!-- Lista de clientes -->
        </div>
      </section>

      <!-- 3. PRODUCTOS -->
      <section id="tab-products" class="panel hidden">
        <div class="panel-header">
          <h2>Vocabulario de Productos</h2>
          <button class="btn-primary" id="btn-new-product">+ Nuevo Producto</button>
        </div>
        <div class="search-bar">
          <input type="text" id="search-products" placeholder="Buscar producto..." class="input-search">
        </div>
        <div class="list-container" id="list-products">
          <!-- Lista de productos -->
        </div>
      </section>

      <!-- 4. TARAS -->
      <section id="tab-tares" class="panel hidden">
        <div class="panel-header">
          <h2>Gesti√≥n de Taras y Envases</h2>
          <button class="btn-primary" id="btn-new-tare">+ Nueva Tara</button>
        </div>
        <div class="list-container" id="list-tares"></div>
      </section>

      <!-- 5. FACTURAS HISTORIAL -->
      <section id="tab-invoices" class="panel hidden">
        <div class="panel-header">
          <h2>Historial de Facturas</h2>
        </div>
        <div class="search-bar">
          <input type="text" id="search-invoices" placeholder="Buscar factura..." class="input-search">
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>N¬∫</th>
              <th>FECHA</th>
              <th>CLIENTE</th>
              <th>TOTAL</th>
              <th>ESTADO</th>
              <th>ACCIONES</th>
            </tr>
          </thead>
          <tbody id="list-invoices"></tbody>
        </table>
      </section>

      <!-- 6. CONTABILIDAD (Protegida) -->
      <section id="tab-accounting" class="panel hidden">
        <div id="accounting-lock" class="lock-screen">
          <h3>üîê ACCESO RESTRINGIDO</h3>
          <p>Introduce PIN Administrador</p>
          <input type="password" id="pin-input-accounting" class="pin-input" maxlength="4">
          <button id="btn-unlock-accounting" class="btn-primary">ENTRAR</button>
        </div>
        <div id="accounting-content" class="hidden">
          <h2>Contabilidad General</h2>
          <div class="kpi-grid">
            <div class="kpi-card">
              <h3>TOTAL VENTAS</h3><span id="kpi-sales">0.00 ‚Ç¨</span>
            </div>
            <div class="kpi-card">
              <h3>TOTAL IVA</h3><span id="kpi-iva">0.00 ‚Ç¨</span>
            </div>
            <div class="kpi-card">
              <h3>FACTURAS</h3><span id="kpi-count">0</span>
            </div>
          </div>
          <div class="filters-row">
            <input type="date" id="acc-date-start">
            <input type="date" id="acc-date-end">
            <button id="btn-filter-acc" class="btn-secondary">Filtrar</button>
          </div>
        </div>
      </section>

      <!-- 7. VENTAS DIARIAS (Protegida) -->
      <section id="tab-sales" class="panel hidden">
        <div id="sales-lock" class="lock-screen">
          <h3>üîê VENTAS DIARIAS</h3>
          <p>Introduce PIN (8410)</p>
          <input type="password" id="pin-input-sales" class="pin-input" maxlength="4">
          <button id="btn-unlock-sales" class="btn-primary">ENTRAR</button>
        </div>
        <div id="sales-content" class="hidden">
          <h2>Cierre de Ventas Diario</h2>
          <div class="tabs-sub">
            <button class="tab-sub active" data-shop="all">GLOBAL</button>
            <button class="tab-sub" data-shop="san_pablo">SAN PABLO</button>
            <button class="tab-sub" data-shop="san_lesmes">SAN LESMES</button>
            <button class="tab-sub" data-shop="santiago">SANTIAGO</button>
          </div>
          <div class="daily-report">
            <!-- Reporte din√°mico -->
            <h3>Reporte: <span id="current-sales-shop">GLOBAL</span></h3>
            <div class="kpi-grid">
              <div class="kpi-card"><span>EFECTIVO</span><strong id="daily-cash">0.00 ‚Ç¨</strong></div>
              <div class="kpi-card"><span>TARJETA</span><strong id="daily-card">0.00 ‚Ç¨</strong></div>
              <div class="kpi-card total"><span>TOTAL</span><strong id="daily-total">0.00 ‚Ç¨</strong></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 8. AJUSTES -->
      <section id="tab-settings" class="panel hidden">
        <h2>Ajustes</h2>
        <div class="form-group">
          <label>PIN ACCESO (Defecto: 8410)</label>
          <input type="text" id="setting-pin" value="8410">
        </div>
        <div class="form-group">
          <label>IVA por defecto (%)</label>
          <input type="number" id="setting-iva" value="4">
        </div>
        <button class="btn-primary" id="btn-save-settings">Guardar Ajustes</button>
      </section>

    </main>
  </div>

  <!-- MODALES -->
  <dialog id="modal-client-select" class="modal">
    <div class="modal-content">
      <h3>Seleccionar Cliente</h3>
      <input type="text" id="modal-search-client" placeholder="Filtrar..." class="input-full">
      <ul id="modal-client-list" class="select-list"></ul>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="document.getElementById('modal-client-select').close()">Cancelar</button>
      </div>
    </div>
  </dialog>

  <script src="src/app.js"></script>
</body>

</html>
