<!-- =========================================================
PARTE 1/4 ‚Äî FACTU MIRAL (B/W PRO)
Archivo: index.html
- Estructura completa (tabs, factura pro, grid pro, visor PDF, contabilidad+ventas con PIN)
- Sin dependencias externas (offline-first). L√≥gica en app.js, estilo en style.css
========================================================= -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>Factu Miral ‚Äî B/W PRO</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- APP SHELL -->
  <div id="app" class="app">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="brand" role="banner" aria-label="Factu Miral">
        <div class="brand__logo" aria-hidden="true">
          <!-- CEREZA B/W (SVG) -->
          <svg viewBox="0 0 64 64" width="28" height="28" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M40 10c0 10-8 18-18 18" stroke="#111" stroke-width="3" stroke-linecap="round"/>
            <path d="M40 10c0 13 7 23 16 26" stroke="#111" stroke-width="3" stroke-linecap="round"/>
            <path d="M28 28c0 8-6 14-14 14S0 36 0 28 6 14 14 14s14 6 14 14Z" fill="#111"/>
            <path d="M64 36c0 8-6 14-14 14s-14-6-14-14 6-14 14-14 14 6 14 14Z" fill="#111"/>
            <path d="M25 8c-2 0-4 2-5 4" stroke="#111" stroke-width="3" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="brand__text">
          <div class="brand__title">FACTU MIRAL</div>
          <div class="brand__sub">B/W PRO ¬∑ Offline-first ¬∑ Cloud opcional</div>
        </div>
      </div>

      <div class="topbar__right">
        <div class="statuspill" id="statusPill" aria-live="polite">
          <span class="dot" id="statusDot" aria-hidden="true"></span>
          <span id="statusText">Local</span>
        </div>

        <button class="btn btn--ghost" id="btnQuickSearch" type="button" title="Buscar (Ctrl+F)">
          Buscar
        </button>
      </div>
    </header>

    <!-- TABS -->
    <nav class="tabs" aria-label="Navegaci√≥n principal">
      <button class="tab is-active" data-tab="tabFactura" id="tabBtnFactura" type="button">Factura</button>
      <button class="tab" data-tab="tabFacturas" id="tabBtnFacturas" type="button">Facturas</button>
      <button class="tab" data-tab="tabClientes" id="tabBtnClientes" type="button">Clientes</button>
      <button class="tab" data-tab="tabProductos" id="tabBtnProductos" type="button">Productos</button>
      <button class="tab" data-tab="tabTaras" id="tabBtnTaras" type="button">Taras</button>
      <button class="tab tab--lock" data-tab="tabContabilidad" id="tabBtnContabilidad" type="button">Contabilidad üîí</button>
      <button class="tab tab--lock" data-tab="tabVentas" id="tabBtnVentas" type="button">Ventas üîí</button>
      <button class="tab" data-tab="tabAjustes" id="tabBtnAjustes" type="button">Ajustes</button>
    </nav>

    <!-- MAIN -->
    <main class="main" role="main">
      <!-- =========================
           TAB: FACTURA (PRINCIPAL)
      ========================== -->
      <section class="pane is-active" id="tabFactura" aria-label="Factura">
        <div class="sheet">
          <!-- FACTURA HEADER GRID -->
          <div class="invoiceHeaderGrid">
            <!-- PROVEEDOR -->
            <section class="card card--tight" aria-label="Proveedor">
              <div class="card__head">
                <h2 class="card__title">Proveedor</h2>
                <div class="card__actions">
                  <button class="btn btn--ghost" id="btnProvGuardar" type="button">Guardar</button>
                </div>
              </div>

              <div class="formGrid">
                <label class="field">
                  <span class="field__label">Nombre</span>
                  <input id="provNombre" class="input" type="text" autocomplete="organization" />
                </label>

                <label class="field">
                  <span class="field__label">NIF</span>
                  <input id="provNif" class="input" type="text" autocomplete="off" />
                </label>

                <label class="field field--full">
                  <span class="field__label">Direcci√≥n</span>
                  <input id="provDir" class="input" type="text" autocomplete="street-address" />
                </label>

                <label class="field">
                  <span class="field__label">Tel√©fono</span>
                  <input id="provTel" class="input" type="tel" inputmode="tel" autocomplete="tel" />
                </label>

                <label class="field">
                  <span class="field__label">Email</span>
                  <input id="provEmail" class="input" type="email" inputmode="email" autocomplete="email" />
                </label>
              </div>
            </section>

            <!-- QR AEAT -->
            <section class="card card--tight qrCard" aria-label="QR tributario AEAT">
              <div class="card__head">
                <h2 class="card__title">QR AEAT</h2>
                <div class="card__actions">
                  <button class="btn btn--ghost" id="btnQrCopiar" type="button">Copiar texto</button>
                </div>
              </div>

              <div class="qrBox">
                <!-- app.js renderiza QR aqu√≠ -->
                <div id="qrCanvasWrap" class="qrCanvasWrap" aria-label="QR"></div>
                <div class="qrTextWrap">
                  <div class="muted">Texto QR (fallback):</div>
                  <pre id="qrText" class="qrText" tabindex="0"></pre>
                </div>
              </div>
            </section>

            <!-- CLIENTE -->
            <section class="card card--tight" aria-label="Cliente">
              <div class="card__head">
                <h2 class="card__title">Cliente</h2>
                <div class="card__actions">
                  <button class="btn btn--ghost" id="btnClienteNuevo" type="button">Nuevo</button>
                  <button class="btn btn--ghost" id="btnClienteGuardar" type="button">Guardar</button>
                </div>
              </div>

              <label class="field">
                <span class="field__label">Seleccionar cliente</span>
                <div class="row">
                  <select id="clienteSelect" class="select" aria-label="Selector de cliente"></select>
                  <button class="btn btn--ghost" id="btnClienteEditarToggle" type="button" title="Editar cliente">
                    Editar
                  </button>
                </div>
              </label>

              <div class="formGrid" id="clienteForm">
                <label class="field">
                  <span class="field__label">Nombre</span>
                  <input id="cliNombre" class="input" type="text" autocomplete="organization" />
                </label>

                <label class="field">
                  <span class="field__label">NIF/CIF</span>
                  <input id="cliNif" class="input" type="text" autocomplete="off" />
                </label>

                <label class="field field--full">
                  <span class="field__label">Direcci√≥n</span>
                  <input id="cliDir" class="input" type="text" autocomplete="street-address" />
                </label>

                <label class="field">
                  <span class="field__label">Tel√©fono</span>
                  <input id="cliTel" class="input" type="tel" inputmode="tel" autocomplete="tel" />
                </label>

                <label class="field">
                  <span class="field__label">Email</span>
                  <input id="cliEmail" class="input" type="email" inputmode="email" autocomplete="email" />
                </label>
              </div>
            </section>
          </div>

          <!-- METADATA + ACTIONS -->
          <section class="card card--tight" aria-label="Metadatos y acciones">
            <div class="metaGrid">
              <div class="metaLeft">
                <div class="metaRow">
                  <div class="metaKey">N¬∫ Factura</div>
                  <div class="metaVal">
                    <span class="badge" id="facturaNumero">FA-‚Äî</span>
                    <button class="btn btn--ghost btn--xs" id="btnRegenNumero" type="button">Regenerar</button>
                  </div>
                </div>

                <div class="metaRow">
                  <div class="metaKey">Fecha</div>
                  <div class="metaVal">
                    <input id="facturaFecha" class="input input--sm" type="date" />
                    <span class="hint" id="facturaFechaES">‚Äî</span>
                  </div>
                </div>

                <div class="metaRow">
                  <div class="metaKey">Tags</div>
                  <div class="metaVal">
                    <input id="facturaTags" class="input input--sm" type="text" placeholder="Ej: SanPablo, Reparto, Centro..." />
                  </div>
                </div>

                <div class="metaRow">
                  <div class="metaKey">Notas internas</div>
                  <div class="metaVal">
                    <input id="facturaNotas" class="input input--sm" type="text" placeholder="Solo pantalla (no PDF)" />
                  </div>
                </div>

                <div class="metaRow metaRow--full">
                  <div class="metaKey">Observaciones</div>
                  <div class="metaVal">
                    <textarea id="facturaObs" class="textarea" rows="2" placeholder="Se imprime en PDF..."></textarea>
                  </div>
                </div>
              </div>

              <div class="metaRight">
                <div class="actionsGrid">
                  <button class="btn" id="btnNuevaFactura" type="button">+ Nueva</button>
                  <button class="btn btn--ghost" id="btnDuplicarFactura" type="button">Duplicar</button>
                  <button class="btn btn--danger" id="btnEliminarFactura" type="button">Eliminar</button>

                  <button class="btn btn--primary" id="btnGuardarFactura" type="button" title="Ctrl+S">Guardar</button>
                  <button class="btn btn--primary" id="btnGenerarPDF" type="button" title="Ctrl+P">Generar PDF</button>
                  <button class="btn btn--ghost" id="btnVerPDF" type="button">Ver PDF</button>

                  <button class="btn btn--ghost" id="btnPdfNube" type="button">PDF + Nube</button>
                  <button class="btn btn--ghost" id="btnWhatsApp" type="button">WhatsApp</button>
                </div>

                <div class="toggles">
                  <label class="toggle">
                    <input type="checkbox" id="chkTransporte" />
                    <span>Transporte</span>
                  </label>

                  <label class="toggle">
                    <input type="checkbox" id="chkIvaIncluido" />
                    <span>IVA incluido (sin desglose)</span>
                  </label>

                  <button class="btn btn--ghost" id="btnAddIva4" type="button">A√±adir 4% IVA</button>
                </div>

                <div class="warnings" id="invoiceWarnings" aria-live="polite"></div>
              </div>
            </div>
          </section>

          <!-- GRID PRO -->
          <section class="card gridCard" aria-label="L√≠neas de factura">
            <div class="card__head">
              <h2 class="card__title">L√≠neas</h2>
              <div class="card__actions">
                <button class="btn btn--ghost" id="btnVaciarLineas" type="button">Vaciar</button>
                <button class="btn" id="btnAddLinea" type="button">+ A√±adir l√≠nea</button>
              </div>
            </div>

            <div class="gridWrap" role="region" aria-label="Grid de l√≠neas">
              <table class="gridPro" id="tablaLineas">
                <thead>
                  <tr>
                    <th class="colProducto">Producto</th>
                    <th class="colModo">Modo</th>
                    <th class="colCant">Cant.</th>
                    <th class="colBruto">Bruto (kg)</th>
                    <th class="colEnvase">Envase/Tara</th>
                    <th class="colEnvases">N¬∫ env.</th>
                    <th class="colTara">Tara (kg)</th>
                    <th class="colNeto">Neto (kg)</th>
                    <th class="colPrecio">Precio</th>
                    <th class="colOrigen">Origen</th>
                    <th class="colImp">Importe</th>
                    <th class="colDel">‚úï</th>
                  </tr>
                </thead>
                <tbody id="lineasBody">
                  <!-- app.js inserta 5 l√≠neas por defecto -->
                </tbody>
              </table>
            </div>

            <div class="gridFooter">
              <div class="hint">
                Enter avanza ¬∑ Al final crea nueva l√≠nea ¬∑ ‚Äú√öltimos precios‚Äù solo en pantalla
              </div>
              <div class="hint right" id="gridHintRight"></div>
            </div>
          </section>

          <!-- TOTALES + PAGOS -->
          <section class="totalsGrid" aria-label="Totales y pagos">
            <div class="card card--tight" aria-label="Totales">
              <div class="card__head">
                <h2 class="card__title">Totales</h2>
              </div>

              <div class="totals">
                <div class="totRow">
                  <div class="totKey">Subtotal</div>
                  <div class="totVal"><span id="totSubtotal">0,00</span> ‚Ç¨</div>
                </div>

                <div class="totRow" id="rowTransporte">
                  <div class="totKey">Transporte</div>
                  <div class="totVal"><span id="totTransporte">0,00</span> ‚Ç¨</div>
                </div>

                <div class="totRow" id="rowIva">
                  <div class="totKey">IVA</div>
                  <div class="totVal"><span id="totIva">0,00</span> ‚Ç¨</div>
                </div>

                <div class="totRow totRow--big">
                  <div class="totKey">TOTAL</div>
                  <div class="totVal"><span id="totTotal">0,00</span> ‚Ç¨</div>
                </div>

                <div class="totRow totRow--big">
                  <div class="totKey">Pendiente</div>
                  <div class="totVal"><span id="totPendiente">0,00</span> ‚Ç¨</div>
                </div>

                <div class="hint" id="ivaIncluidoHint">‚Äî</div>
              </div>
            </div>

            <div class="card card--tight" aria-label="Pagos">
              <div class="card__head">
                <h2 class="card__title">Pagos</h2>
              </div>

              <div class="payBox">
                <div class="row">
                  <label class="field">
                    <span class="field__label">M√©todo</span>
                    <select id="pagoMetodo" class="select">
                      <option value="efectivo">Efectivo</option>
                      <option value="transferencia">Transferencia</option>
                      <option value="tarjeta">Tarjeta</option>
                    </select>
                  </label>

                  <label class="field">
                    <span class="field__label">Importe</span>
                    <input id="pagoImporte" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
                  </label>

                  <label class="field">
                    <span class="field__label">Fecha</span>
                    <input id="pagoFecha" class="input" type="date" />
                  </label>

                  <button class="btn btn--primary" id="btnAddPago" type="button">A√±adir</button>
                </div>

                <div class="payListWrap">
                  <table class="simpleTable" aria-label="Lista de pagos">
                    <thead>
                      <tr>
                        <th>Fecha</th>
                        <th>M√©todo</th>
                        <th>Importe</th>
                        <th>‚úï</th>
                      </tr>
                    </thead>
                    <tbody id="pagosBody">
                      <!-- app.js renderiza -->
                    </tbody>
                  </table>
                </div>

                <div class="hint" id="estadoFacturaHint">Estado: ‚Äî</div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: FACTURAS (LISTADO)
      ========================== -->
      <section class="pane" id="tabFacturas" aria-label="Listado de facturas">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Facturas</h2>
              <div class="card__actions">
                <input id="facturasBuscar" class="input input--sm" type="search" placeholder="Buscar n¬∫ / cliente / tag / fecha..." />
              </div>
            </div>

            <div class="tableWrap">
              <table class="simpleTable" id="facturasTabla" aria-label="Tabla de facturas">
                <thead>
                  <tr>
                    <th>N¬∫</th>
                    <th>Fecha</th>
                    <th>Cliente</th>
                    <th>Tags</th>
                    <th>Total</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="facturasBody">
                  <!-- app.js renderiza -->
                </tbody>
              </table>
            </div>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: CLIENTES
      ========================== -->
      <section class="pane" id="tabClientes" aria-label="Clientes">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Clientes</h2>
              <div class="card__actions">
                <input id="clientesBuscar" class="input input--sm" type="search" placeholder="Buscar cliente..." />
                <button class="btn" id="btnClientesNuevo" type="button">+ Nuevo</button>
              </div>
            </div>

            <div class="tableWrap">
              <table class="simpleTable" aria-label="Tabla de clientes">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>NIF/CIF</th>
                    <th>Direcci√≥n</th>
                    <th>Tel</th>
                    <th>Email</th>
                    <th>Plantilla</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="clientesBody">
                  <!-- app.js renderiza -->
                </tbody>
              </table>
            </div>
          </section>

          <section class="card card--tight" aria-label="Editor de cliente">
            <div class="card__head">
              <h2 class="card__title">Editor</h2>
              <div class="card__actions">
                <button class="btn btn--primary" id="btnClientesGuardar" type="button">Guardar</button>
                <button class="btn btn--danger" id="btnClientesEliminar" type="button">Eliminar</button>
              </div>
            </div>

            <div class="formGrid">
              <label class="field field--full">
                <span class="field__label">Nombre fiscal</span>
                <input id="cliEdNombre" class="input" type="text" />
              </label>

              <label class="field field--full">
                <span class="field__label">Alias / Comercial (opcional)</span>
                <input id="cliEdAlias" class="input" type="text" />
              </label>

              <label class="field">
                <span class="field__label">NIF/CIF</span>
                <input id="cliEdNif" class="input" type="text" />
              </label>

              <label class="field">
                <span class="field__label">Tel√©fono</span>
                <input id="cliEdTel" class="input" type="tel" inputmode="tel" />
              </label>

              <label class="field field--full">
                <span class="field__label">Direcci√≥n</span>
                <input id="cliEdDir" class="input" type="text" />
              </label>

              <label class="field field--full">
                <span class="field__label">Email</span>
                <input id="cliEdEmail" class="input" type="email" inputmode="email" />
              </label>

              <label class="field field--full">
                <span class="field__label">Notas</span>
                <textarea id="cliEdNotas" class="textarea" rows="2"></textarea>
              </label>

              <div class="split">
                <div class="box">
                  <div class="box__title">Plantilla</div>
                  <label class="toggle">
                    <input type="checkbox" id="cliTplIvaIncluido" />
                    <span>IVA incluido por defecto</span>
                  </label>
                  <label class="toggle">
                    <input type="checkbox" id="cliTplTransporte" />
                    <span>Transporte por defecto</span>
                  </label>

                  <label class="field">
                    <span class="field__label">M√©todo pago por defecto</span>
                    <select id="cliTplPago" class="select">
                      <option value="">‚Äî</option>
                      <option value="efectivo">Efectivo</option>
                      <option value="transferencia">Transferencia</option>
                      <option value="tarjeta">Tarjeta</option>
                    </select>
                  </label>

                  <label class="field">
                    <span class="field__label">Tags autom√°ticos</span>
                    <input id="cliTplTags" class="input" type="text" placeholder="Ej: SanPablo, Tienda..." />
                  </label>

                  <label class="field">
                    <span class="field__label">Nota est√°ndar</span>
                    <input id="cliTplNotaStd" class="input" type="text" placeholder="Se a√±ade al crear factura..." />
                  </label>
                </div>

                <div class="box">
                  <div class="box__title">Protecciones</div>
                  <div class="hint">
                    Eliminar cliente solo si NO est√° usado en facturas (app.js aplica protecci√≥n).
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: PRODUCTOS
      ========================== -->
      <section class="pane" id="tabProductos" aria-label="Productos">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Productos</h2>
              <div class="card__actions">
                <input id="productosBuscar" class="input input--sm" type="search" placeholder="Buscar producto..." />
                <button class="btn" id="btnProductosNuevo" type="button">+ Nuevo</button>
              </div>
            </div>

            <div class="tableWrap">
              <table class="simpleTable" aria-label="Tabla de productos">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Modo</th>
                    <th>Kg/Caja</th>
                    <th>‚Ç¨/kg</th>
                    <th>‚Ç¨/caja</th>
                    <th>‚Ç¨/ud</th>
                    <th>Coste</th>
                    <th>Origen</th>
                    <th>Envase</th>
                    <th>Historial</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="productosBody">
                  <!-- app.js renderiza -->
                </tbody>
              </table>
            </div>
          </section>

          <section class="card card--tight" aria-label="Editor de producto">
            <div class="card__head">
              <h2 class="card__title">Editor</h2>
              <div class="card__actions">
                <button class="btn btn--primary" id="btnProductosGuardar" type="button">Guardar</button>
                <button class="btn btn--danger" id="btnProductosEliminar" type="button">Eliminar</button>
              </div>
            </div>

            <div class="formGrid">
              <label class="field field--full">
                <span class="field__label">Nombre</span>
                <input id="proEdNombre" class="input" type="text" />
              </label>

              <label class="field">
                <span class="field__label">Modo por defecto</span>
                <select id="proEdModo" class="select">
                  <option value="kg">kg</option>
                  <option value="caja">caja</option>
                  <option value="ud">ud</option>
                </select>
              </label>

              <label class="field">
                <span class="field__label">Kg por caja</span>
                <input id="proEdKgCaja" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Precio ‚Ç¨/kg</span>
                <input id="proEdPkg" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Precio ‚Ç¨/caja</span>
                <input id="proEdPcaja" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Precio ‚Ç¨/ud</span>
                <input id="proEdPud" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Coste (margen)</span>
                <input id="proEdCoste" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Origen por defecto</span>
                <input id="proEdOrigen" class="input" type="text" placeholder="Ej: Espa√±a" />
              </label>

              <label class="field field--full">
                <span class="field__label">Envase/Tara por defecto</span>
                <select id="proEdEnvase" class="select"></select>
              </label>

              <div class="box field--full">
                <div class="box__title">Historial (√∫ltimas 5) ‚Äî Solo pantalla</div>
                <div id="proEdHistorial" class="histList">‚Äî</div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: TARAS
      ========================== -->
      <section class="pane" id="tabTaras" aria-label="Taras">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Taras / Envases</h2>
              <div class="card__actions">
                <input id="tarasBuscar" class="input input--sm" type="search" placeholder="Buscar tara..." />
                <button class="btn" id="btnTarasNuevo" type="button">+ Nueva</button>
              </div>
            </div>

            <div class="tableWrap">
              <table class="simpleTable" aria-label="Tabla de taras">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Tara unidad (kg)</th>
                    <th>Notas</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="tarasBody">
                  <!-- app.js renderiza -->
                </tbody>
              </table>
            </div>
          </section>

          <section class="card card--tight" aria-label="Editor de tara">
            <div class="card__head">
              <h2 class="card__title">Editor</h2>
              <div class="card__actions">
                <button class="btn btn--primary" id="btnTarasGuardar" type="button">Guardar</button>
                <button class="btn btn--danger" id="btnTarasEliminar" type="button">Eliminar</button>
              </div>
            </div>

            <div class="formGrid">
              <label class="field field--full">
                <span class="field__label">Nombre</span>
                <input id="taraEdNombre" class="input" type="text" placeholder="Ej: Caja pl√°stico ESMO" />
              </label>

              <label class="field">
                <span class="field__label">Peso tara unidad (kg)</span>
                <input id="taraEdPeso" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.30" />
              </label>

              <label class="field field--full">
                <span class="field__label">Notas</span>
                <input id="taraEdNotas" class="input" type="text" placeholder="Opcional" />
              </label>

              <div class="hint field--full">
                En factura: Tara total = N¬∫ envases √ó Tara unidad. En modo KG se descuenta del bruto para calcular neto.
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: CONTABILIDAD (PIN)
      ========================== -->
      <section class="pane" id="tabContabilidad" aria-label="Contabilidad">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Contabilidad üîí</h2>
              <div class="card__actions">
                <button class="btn btn--ghost" id="btnLockContabilidad" type="button">Bloquear</button>
              </div>
            </div>

            <div class="hint">
              Requiere PIN (configurable en Ajustes). Factura siempre libre.
            </div>

            <div class="filters">
              <label class="field">
                <span class="field__label">Desde</span>
                <input id="contDesde" class="input" type="date" />
              </label>
              <label class="field">
                <span class="field__label">Hasta</span>
                <input id="contHasta" class="input" type="date" />
              </label>
              <label class="field">
                <span class="field__label">Cliente</span>
                <select id="contCliente" class="select"></select>
              </label>
              <label class="field">
                <span class="field__label">Tag</span>
                <input id="contTag" class="input" type="text" placeholder="Ej: SanPablo" />
              </label>
              <button class="btn btn--primary" id="btnContFiltrar" type="button">Filtrar</button>
              <button class="btn btn--ghost" id="btnContExport" type="button">Export CSV</button>
            </div>

            <div class="kpis" aria-label="KPIs">
              <div class="kpi">
                <div class="kpi__label">Ventas</div>
                <div class="kpi__value" id="kpiVentas">0,00 ‚Ç¨</div>
              </div>
              <div class="kpi">
                <div class="kpi__label">IVA</div>
                <div class="kpi__value" id="kpiIva">0,00 ‚Ç¨</div>
              </div>
              <div class="kpi">
                <div class="kpi__label">N¬∫ facturas</div>
                <div class="kpi__value" id="kpiNum">0</div>
              </div>
              <div class="kpi">
                <div class="kpi__label">Margen</div>
                <div class="kpi__value" id="kpiMargen">‚Äî</div>
              </div>
            </div>

            <div class="tableWrap">
              <table class="simpleTable" aria-label="Resultados contabilidad">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>N¬∫</th>
                    <th>Cliente</th>
                    <th>Total</th>
                    <th>Tags</th>
                    <th>Estado</th>
                    <th>Pendiente</th>
                  </tr>
                </thead>
                <tbody id="contBody">
                  <!-- app.js renderiza -->
                </tbody>
              </table>
            </div>

            <section class="card card--tight" aria-label="Dashboard mensual">
              <div class="card__head">
                <h3 class="card__title">Dashboard mensual</h3>
              </div>
              <div class="dashGrid">
                <div class="box">
                  <div class="box__title">Ventas por mes</div>
                  <div id="dashVentasMes" class="mono">‚Äî</div>
                </div>
                <div class="box">
                  <div class="box__title">Top clientes</div>
                  <div id="dashTopClientes" class="mono">‚Äî</div>
                </div>
                <div class="box">
                  <div class="box__title">Top productos</div>
                  <div id="dashTopProductos" class="mono">‚Äî</div>
                </div>
                <div class="box">
                  <div class="box__title">Pendientes</div>
                  <div id="dashPendientes" class="mono">‚Äî</div>
                </div>
              </div>
            </section>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: VENTAS DIARIAS (PIN 8410)
      ========================== -->
      <section class="pane" id="tabVentas" aria-label="Ventas diarias">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Ventas diarias üîí (PIN 8410)</h2>
              <div class="card__actions">
                <button class="btn btn--ghost" id="btnLockVentas" type="button">Bloquear</button>
              </div>
            </div>

            <div class="filters">
              <label class="field">
                <span class="field__label">Fecha</span>
                <input id="ventaFecha" class="input" type="date" />
              </label>

              <label class="field">
                <span class="field__label">Tienda</span>
                <select id="ventaTienda" class="select">
                  <option value="San Pablo">San Pablo</option>
                  <option value="San Lesmes">San Lesmes</option>
                  <option value="Santiago">Santiago</option>
                </select>
              </label>

              <label class="field">
                <span class="field__label">Efectivo</span>
                <input id="ventaEfectivo" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Tarjeta</span>
                <input id="ventaTarjeta" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <label class="field">
                <span class="field__label">Gastos</span>
                <input id="ventaGastos" class="input" type="number" inputmode="decimal" step="0.01" placeholder="0.00" />
              </label>

              <button class="btn btn--primary" id="btnVentaGuardar" type="button">Guardar</button>
              <button class="btn btn--ghost" id="btnVentaNuevo" type="button">Nuevo</button>
            </div>

            <div class="hint" id="ventaDiaSemana">D√≠a: ‚Äî</div>

            <div class="kpis" aria-label="KPIs ventas">
              <div class="kpi">
                <div class="kpi__label">Total d√≠a</div>
                <div class="kpi__value" id="kpiVentaTotalDia">0,00 ‚Ç¨</div>
              </div>
              <div class="kpi">
                <div class="kpi__label">Global efectivo</div>
                <div class="kpi__value" id="kpiVentaGlobalEf">0,00 ‚Ç¨</div>
              </div>
              <div class="kpi">
                <div class="kpi__label">Global tarjeta</div>
                <div class="kpi__value" id="kpiVentaGlobalTar">0,00 ‚Ç¨</div>
              </div>
              <div class="kpi">
                <div class="kpi__label">Neto (d√≠a)</div>
                <div class="kpi__value" id="kpiVentaNetoDia">0,00 ‚Ç¨</div>
              </div>
            </div>

            <div class="filters">
              <label class="field">
                <span class="field__label">Desde</span>
                <input id="ventasDesde" class="input" type="date" />
              </label>
              <label class="field">
                <span class="field__label">Hasta</span>
                <input id="ventasHasta" class="input" type="date" />
              </label>
              <label class="field">
                <span class="field__label">Reporte</span>
                <select id="ventasModo" class="select">
                  <option value="diario">Diario</option>
                  <option value="semanal">Semanal</option>
                  <option value="mensual">Mensual</option>
                  <option value="rango">Rango</option>
                </select>
              </label>
              <button class="btn btn--primary" id="btnVentasReporte" type="button">Generar</button>
              <button class="btn btn--ghost" id="btnVentasExport" type="button">Export CSV</button>
            </div>

            <div class="tableWrap">
              <table class="simpleTable" aria-label="Tabla ventas diarias">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>D√≠a</th>
                    <th>Tienda</th>
                    <th>Efectivo</th>
                    <th>Tarjeta</th>
                    <th>Total</th>
                    <th>Gastos</th>
                    <th>Neto</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="ventasBody">
                  <!-- app.js renderiza -->
                </tbody>
              </table>
            </div>

            <section class="card card--tight" aria-label="Resumen ventas">
              <div class="card__head">
                <h3 class="card__title">Resumen</h3>
              </div>
              <div class="dashGrid">
                <div class="box">
                  <div class="box__title">Reporte seleccionado</div>
                  <div id="ventasResumen" class="mono">‚Äî</div>
                </div>
                <div class="box">
                  <div class="box__title">Totales</div>
                  <div id="ventasTotales" class="mono">‚Äî</div>
                </div>
              </div>
            </section>
          </section>
        </div>
      </section>

      <!-- =========================
           TAB: AJUSTES
      ========================== -->
      <section class="pane" id="tabAjustes" aria-label="Ajustes">
        <div class="sheet">
          <section class="card">
            <div class="card__head">
              <h2 class="card__title">Ajustes</h2>
            </div>

            <div class="split">
              <div class="box">
                <div class="box__title">Impuestos</div>

                <label class="field">
                  <span class="field__label">IVA (%)</span>
                  <input id="setIva" class="input" type="number" inputmode="decimal" step="0.01" placeholder="4" />
                </label>

                <label class="field">
                  <span class="field__label">Transporte (%)</span>
                  <input id="setTransporte" class="input" type="number" inputmode="decimal" step="0.01" placeholder="10" />
                </label>

                <div class="hint">Transporte solo aparece en factura/PDF si est√° activado.</div>
              </div>

              <div class="box">
                <div class="box__title">Seguridad</div>

                <label class="field">
                  <span class="field__label">PIN contabilidad (admin)</span>
                  <input id="setPinCont" class="input" type="password" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                </label>

                <div class="hint">Ventas diarias usa PIN fijo: 8410.</div>
              </div>
            </div>

            <div class="box">
              <div class="box__title">QR AEAT</div>

              <label class="field field--full">
                <span class="field__label">Plantilla / base texto QR</span>
                <textarea id="setQrBase" class="textarea" rows="3" placeholder="(configurable)"></textarea>
              </label>

              <div class="hint">
                El texto final del QR se genera con NIF proveedor, N¬∫ factura, fecha y total (validado).
              </div>
            </div>

            <div class="box">
              <div class="box__title">Cloud (Firebase) ‚Äî Opcional</div>
              <div class="hint">
                Si NO se configura, el sistema funciona en local sin errores.
              </div>

              <div class="formGrid">
                <label class="field">
                  <span class="field__label">apiKey</span>
                  <input id="fbApiKey" class="input" type="text" autocomplete="off" />
                </label>
                <label class="field">
                  <span class="field__label">authDomain</span>
                  <input id="fbAuthDomain" class="input" type="text" autocomplete="off" />
                </label>
                <label class="field">
                  <span class="field__label">databaseURL</span>
                  <input id="fbDbUrl" class="input" type="text" autocomplete="off" />
                </label>
                <label class="field">
                  <span class="field__label">projectId</span>
                  <input id="fbProjectId" class="input" type="text" autocomplete="off" />
                </label>
                <label class="field">
                  <span class="field__label">appId</span>
                  <input id="fbAppId" class="input" type="text" autocomplete="off" />
                </label>
                <label class="field">
                  <span class="field__label">storageBucket</span>
                  <input id="fbStorageBucket" class="input" type="text" autocomplete="off" />
                </label>
              </div>

              <div class="row right">
                <button class="btn btn--ghost" id="btnFbTest" type="button">Test</button>
                <button class="btn btn--primary" id="btnFbGuardar" type="button">Guardar</button>
                <button class="btn btn--ghost" id="btnFbLogout" type="button">Salir</button>
              </div>

              <div class="hint" id="fbHint">Cloud: ‚Äî</div>
            </div>
          </section>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="muted">
        Factu Miral ¬∑ B/W PRO ¬∑ Offline-first ¬∑ <span id="appVersion">v1.0</span>
      </div>
      <div class="muted">
        Atajos: Ctrl+S Guardar ¬∑ Ctrl+P PDF ¬∑ Ctrl+F Buscar
      </div>
    </footer>
  </div>

  <!-- =========================
       MODAL: VISOR PDF
  ========================== -->
  <div class="modal" id="pdfModal" aria-hidden="true" role="dialog" aria-label="Visor PDF">
    <div class="modal__backdrop" data-close="1"></div>
    <div class="modal__panel">
      <div class="modal__head">
        <div class="modal__title">Visor PDF</div>
        <div class="modal__actions">
          <button class="btn btn--ghost" id="btnPdfImprimir" type="button">Imprimir</button>
          <button class="btn btn--ghost" id="btnPdfAbrir" type="button">Abrir pesta√±a</button>
          <button class="btn btn--danger" id="btnPdfCerrar" type="button">Cerrar</button>
        </div>
      </div>

      <div class="modal__body">
        <!-- app.js coloca el blob/url -->
        <iframe id="pdfFrame" class="pdfFrame" title="PDF" loading="lazy"></iframe>
      </div>
    </div>
  </div>

  <!-- =========================
       MODAL: PIN (CONTABILIDAD / VENTAS)
  ========================== -->
  <div class="modal" id="pinModal" aria-hidden="true" role="dialog" aria-label="Acceso con PIN">
    <div class="modal__backdrop" data-close="1"></div>
    <div class="modal__panel modal__panel--sm">
      <div class="modal__head">
        <div class="modal__title" id="pinTitle">Acceso protegido</div>
        <div class="modal__actions">
          <button class="btn btn--danger" id="btnPinCerrar" type="button">Cerrar</button>
        </div>
      </div>

      <div class="modal__body">
        <div class="hint" id="pinHint">Introduce el PIN.</div>

        <label class="field">
          <span class="field__label">PIN</span>
          <input id="pinInput" class="input" type="password" inputmode="numeric" autocomplete="one-time-code" />
        </label>

        <div class="row right">
          <button class="btn btn--primary" id="btnPinOk" type="button">Entrar</button>
        </div>

        <div class="warnings" id="pinWarn" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- =========================
       TOASTS
  ========================== -->
  <div class="toasts" id="toasts" aria-live="polite" aria-relevant="additions"></div>

  <!-- APP LOGIC -->
  <script src="./app.js" defer></script>
</body>
</html>
