<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ARSLAN PRO V10.4 ‚Äî KIWI Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <!-- Librer√≠as de terceros (gr√°ficas, PDF y QR) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <!-- Firebase (Compat, sin m√≥dulos) para evitar errores de import -->
  <script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-database-compat.js"></script>
</head>
<body>

<header class="topbar">
  <div class="brand">
    <!-- Logo kiwi incrustado (SVG embebido en data URL, sin archivos externos) -->
    <img id="logoApp" alt="KIWI"
      src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'><defs><radialGradient id='g' cx='50%' cy='50%' r='50%'><stop offset='0%' stop-color='%23d9f99d'/><stop offset='70%' stop-color='%2316a34a'/><stop offset='100%' stop-color='%230a7f39'/></radialGradient></defs><circle cx='48' cy='48' r='44' fill='url(%23g)' stroke='%230a7f39' stroke-width='4'/><circle cx='48' cy='48' r='18' fill='%23fefce8' stroke='%2365a30d' stroke-width='3'/><g fill='%2316a34a'><circle cx='48' cy='32' r='2'/><circle cx='58' cy='36' r='2'/><circle cx='38' cy='36' r='2'/><circle cx='62' cy='46' r='2'/><circle cx='34' cy='46' r='2'/><circle cx='58' cy='58' r='2'/><circle cx='38' cy='58' r='2'/><circle cx='48' cy='64' r='2'/></g><circle cx='48' cy='48' r='3.2' fill='%23111'/></svg>" />
    <span>ARSLAN PRO <small>V10.4</small></span>
  </div>

  <nav class="tabs">
    <button class="tab active" data-tab="factura">Factura</button>
    <button class="tab" data-tab="clientes">Clientes</button>
    <button class="tab" data-tab="facturas">Facturas</button>
    <button class="tab" data-tab="productos">Productos</button>
    <button class="tab" data-tab="pendientes">Pendientes</button>
    <button class="tab" data-tab="ventas">Ventas</button>
    <button class="tab" data-tab="resumen">Resumen</button>
  </nav>

  <!-- Indicador de sincronizaci√≥n Firebase (se controla desde app.js) -->
  <div class="sync-indicator" id="syncIndicator" title="Sincronizaci√≥n Firebase">
    <span class="dot" id="syncDot"></span><span id="syncText">Sync</span>
  </div>
</header>

<main class="container">

  <!-- FACTURA -->
  <section class="panel active" data-tab-panel="factura">
    <div class="grid2">
      <div class="card">
        <h3>Proveedor</h3>
        <input id="provNombre" placeholder="Nombre proveedor" />
        <input id="provNif" placeholder="NIF/CIF" />
        <input id="provDir" placeholder="Direcci√≥n" />
        <input id="provTel" placeholder="Tel√©fono" />
        <input id="provEmail" placeholder="Email" />
      </div>
      <div class="card">
        <h3>Cliente</h3>
        <select id="selCliente"></select>
        <input id="cliNombre" placeholder="Nombre cliente" />
        <input id="cliNif" placeholder="NIF/CIF" />
        <input id="cliDir" placeholder="Direcci√≥n" />
        <input id="cliTel" placeholder="Tel√©fono" />
        <input id="cliEmail" placeholder="Email" />
        <div class="row">
          <button id="btnNuevoCliente" class="ghost">Abrir listado</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="title-row">
        <h3>Cuadro de c√°lculo (cuadr√≠cula)</h3>
        <div class="row">
          <button id="btnAddLinea">+ A√±adir l√≠nea</button>
          <button id="btnVaciarLineas" class="ghost">Vaciar</button>
        </div>
      </div>

      <!-- Autocompletado de productos -->
      <datalist id="productNamesList"></datalist>

      <div class="table-wrap">
        <table class="calc-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Modo</th>
              <th>Cant.</th>
              <th>Bruto (kg)</th>
              <th>Tara (kg)</th>
              <th>Neto (kg)</th>
              <th>Precio</th>
              <th>Origen</th>
              <th>Importe</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="lineasBody"></tbody>
        </table>
      </div>
    </div>

    <div class="grid3">
      <div class="card">
        <h3>üí∂ Totales factura</h3>

        <!-- Transporte 10% (opcional) -->
        <label class="check">
          <input type="checkbox" id="chkTransporte" />
          A√±adir transporte 10%
        </label>

        <!-- IVA 4% (si se marca, se calcula y NO se muestra el mensaje de ‚ÄúIVA incluido‚Äù) -->
        <label class="check">
          <input type="checkbox" id="chkIvaAplicado" />
          Aplicar IVA 4% (no mostrar mensaje ‚ÄúIVA incluido‚Äù)
        </label>

        <!-- Mensaje alternativo de IVA incluido (solo informativo si NO se aplica IVA 4%) -->
        <label class="check">
          <input type="checkbox" id="chkIvaIncluido" checked />
          IVA 4% incluido (informativo)
        </label>

        <div class="totals-grid">
          <div>Subtotal</div><div id="subtotal">0,00 ‚Ç¨</div>
          <div>Transporte</div><div id="transp">0,00 ‚Ç¨</div>
          <div>IVA (4%)</div><div id="iva">0,00 ‚Ç¨</div>
          <div class="big">TOTAL</div><div class="big" id="total">0,00 ‚Ç¨</div>
        </div>
      </div>

      <div class="card">
        <h3>Pagos</h3>
        <div class="row">
          <input id="inpPagoParcial" type="number" step="0.01" placeholder="Importe parcial" />
          <button id="btnAddPago" class="ghost">+ A√±adir pago</button>
        </div>
        <div id="listaPagos" class="list small"></div>
        <label class="mt8">Pagado manual
          <input id="pagado" type="number" step="0.01" />
        </label>
        <label>Estado
          <select id="estado">
            <option value="pendiente">Impagada</option>
            <option value="parcial">Parcial</option>
            <option value="pagado">Pagada</option>
          </select>
        </label>
        <label>M√©todo
          <select id="metodoPago">
            <option>Efectivo</option><option>Tarjeta</option><option>Transferencia</option>
          </select>
        </label>
        <div class="pendiente">Pendiente: <strong id="pendiente">0,00 ‚Ç¨</strong></div>
      </div>

      <div class="card">
        <h3>Observaciones</h3>
        <textarea id="observaciones" rows="6" placeholder="Notas, condiciones, etc."></textarea>
      </div>
    </div>

    <div class="row actions">
      <button id="btnGuardar">üíæ Guardar</button>
      <button id="btnImprimir">üñ®Ô∏è Generar PDF</button>
      <button id="btnNueva" class="ghost">üßæ Nueva</button>
    </div>

    <!-- √Årea PDF (encabezado solo mostrar√° ‚ÄúFACTURA‚Äù y el logo kiwi peque√±o) -->
    <div id="printArea" class="print">
      <div class="pdf-header">
        <div class="pdf-brand">
          <!-- Mismo logo incrustado -->
          <img alt="Kiwi"
            src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'><defs><radialGradient id='g' cx='50%' cy='50%' r='50%'><stop offset='0%' stop-color='%23d9f99d'/><stop offset='70%' stop-color='%2316a34a'/><stop offset='100%' stop-color='%230a7f39'/></radialGradient></defs><circle cx='48' cy='48' r='44' fill='url(%23g)' stroke='%230a7f39' stroke-width='4'/><circle cx='48' cy='48' r='18' fill='%23fefce8' stroke='%2365a30d' stroke-width='3'/><g fill='%2316a34a'><circle cx='48' cy='32' r='2'/><circle cx='58' cy='36' r='2'/><circle cx='38' cy='36' r='2'/><circle cx='62' cy='46' r='2'/><circle cx='34' cy='46' r='2'/><circle cx='58' cy='58' r='2'/><circle cx='38' cy='58' r='2'/><circle cx='48' cy='64' r='2'/></g><circle cx='48' cy='48' r='3.2' fill='%23111'/></svg>" />
          <div>
            <h2>FACTURA</h2>
            <div id="p-prov"></div>
          </div>
        </div>
        <div class="pdf-meta">
          <div><span>N¬∫ Factura:</span> <strong id="p-num"></strong></div>
          <div><span>Fecha:</span> <strong id="p-fecha"></strong></div>
          <div><span>Cliente:</span><div id="p-cli"></div></div>
          <canvas id="p-qr" width="92" height="92"></canvas>
        </div>
      </div>

      <table id="p-tabla">
        <thead>
          <tr>
            <th>Producto</th><th>Modo</th><th>Cant.</th><th>Bruto</th><th>Tara</th><th>Neto</th><th>Precio</th><th>Origen</th><th>Importe</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="pdf-totales">
        <div>
          <div>Subtotal: <strong id="p-sub">0,00 ‚Ç¨</strong></div>
          <div>Transporte: <strong id="p-tra">0,00 ‚Ç¨</strong></div>
          <div>IVA (4%): <strong id="p-iva">0,00 ‚Ç¨</strong></div>
          <div class="big">Total: <strong id="p-tot">0,00 ‚Ç¨</strong></div>
        </div>
        <div>
          <div>Estado: <strong id="p-estado">Impagada</strong></div>
          <div>M√©todo: <strong id="p-metodo">Efectivo</strong></div>
          <div>Obs.: <span id="p-obs">‚Äî</span></div>
        </div>
      </div>

      <!-- Este pie de p√°gina se actualizar√° desde app.js:
           - Si ‚ÄúAplicar IVA 4%‚Äù est√° activo ‚Üí NO se muestra el mensaje de ‚ÄúIVA incluido‚Äù.
           - Si NO est√° activo y est√° marcado ‚ÄúIVA incluido (informativo)‚Äù ‚Üí se muestra el mensaje. -->
      <div class="pdf-foot" id="pdf-foot-note">IVA incluido en los precios.</div>
    </div>

    <!-- Historial de precios -->
    <aside id="pricePanel" hidden>
      <div class="pp-title">Historial de precios</div>
      <div id="ppBody"></div>
    </aside>
  </section>

  <!-- CLIENTES -->
  <section class="panel" data-tab-panel="clientes">
    <div class="card">
      <div class="title-row">
        <h3>Clientes</h3>
        <div class="row">
          <input id="buscarCliente" class="search" placeholder="Buscar cliente‚Ä¶" />
          <button id="btnAddCliente">+ A√±adir</button>
          <button id="btnExportClientes" class="ghost">‚§ì Exportar</button>
          <button id="btnImportClientes" class="ghost">‚§í Importar</button>
        </div>
      </div>
      <div id="listaClientes" class="list"></div>
    </div>
  </section>

  <!-- FACTURAS -->
  <section class="panel" data-tab-panel="facturas">
    <div class="card">
      <div class="title-row">
        <h3>Facturas</h3>
        <div class="row">
          <select id="filtroEstado">
            <option value="todas">Todas</option>
            <option value="pendiente">Impagadas</option>
            <option value="parcial">Parciales</option>
            <option value="pagado">Pagadas</option>
          </select>
          <input id="buscaCliente" class="search" placeholder="Buscar por cliente‚Ä¶" />
          <button id="btnExportFacturas" class="ghost">‚§ì Exportar</button>
          <button id="btnImportFacturas" class="ghost">‚§í Importar</button>
        </div>
      </div>
      <div id="listaFacturas" class="list"></div>
    </div>
  </section>

  <!-- PRODUCTOS -->
  <section class="panel" data-tab-panel="productos">
    <div class="card">
      <div class="title-row">
        <h3>Productos</h3>
        <div class="row">
          <input id="buscarProducto" class="search" placeholder="Buscar producto‚Ä¶" />
          <button id="btnAddProducto">+ A√±adir</button>
          <button id="btnExportProductos" class="ghost">‚§ì Exportar</button>
          <button id="btnImportProductos" class="ghost">‚§í Importar</button>
        </div>
      </div>
      <div id="listaProductos" class="listaProductos"></div>
    </div>
  </section>

  <!-- PENDIENTES -->
  <section class="panel" data-tab-panel="pendientes">
    <div class="card">
      <div class="title-row">
        <h3>Deudas por cliente</h3>
        <div class="row">
          <button id="btnResetCliente" class="ghost">Reset deudas del cliente actual</button>
          <button id="btnResetGlobal" class="ghost">Reset deudas global</button>
        </div>
      </div>
      <table class="calc-table" id="tblPendientes">
        <thead>
          <tr><th>Cliente</th><th>N¬∫ facturas pendientes</th><th>Total pendiente</th><th>√öltima factura</th><th>Acciones</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="pendiente total">Total pendiente global: <strong id="resGlobal">0,00 ‚Ç¨</strong></div>
    </div>
  </section>

  <!-- VENTAS -->
  <section class="panel" data-tab-panel="ventas">
    <div class="grid2">
      <div class="card">
        <h3>Totales globales</h3>
        <div class="kpis">
          <div class="kpi"><span>Hoy</span><strong id="vHoy">0,00 ‚Ç¨</strong></div>
          <div class="kpi"><span>Semana</span><strong id="vSemana">0,00 ‚Ç¨</strong></div>
          <div class="kpi"><span>Mes</span><strong id="vMes">0,00 ‚Ç¨</strong></div>
          <div class="kpi"><span>Total</span><strong id="vTotal">0,00 ‚Ç¨</strong></div>
        </div>
      </div>
      <div class="card">
        <h3>Top 10 productos (total ‚Ç¨)</h3>
        <canvas id="chartTop" height="160"></canvas>
      </div>
    </div>

    <div class="grid2">
      <div class="card">
        <h3>Ventas diarias (7 d√≠as)</h3>
        <canvas id="chartDiario" height="140"></canvas>
      </div>
      <div class="card">
        <h3>Ventas mensuales (12 meses)</h3>
        <canvas id="chartMensual" height="140"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="title-row">
        <h3>Detalle por cliente</h3>
        <div class="row">
          <input id="ventasFiltroMes" type="month" />
          <button id="btnExportVentas" class="ghost">üì§ Exportar CSV</button>
        </div>
      </div>
      <table class="calc-table" id="tblVentasCliente">
        <thead>
          <tr><th>Cliente</th><th>Hoy</th><th>Semana</th><th>Mes</th><th>Total</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- RESUMEN -->
  <section class="panel" data-tab-panel="resumen">
    <div class="card">
      <h3>Resumen r√°pido</h3>
      <div class="kpis">
        <div class="kpi"><span>Hoy</span><strong id="rHoy">0,00 ‚Ç¨</strong></div>
        <div class="kpi"><span>Semana</span><strong id="rSemana">0,00 ‚Ç¨</strong></div>
        <div class="kpi"><span>Mes</span><strong id="rMes">0,00 ‚Ç¨</strong></div>
        <div class="kpi"><span>Total</span><strong id="rTotal">0,00 ‚Ç¨</strong></div>
      </div>
      <div class="row actions mt8">
        <button id="btnBackup">Backup</button>
        <button id="btnRestore" class="ghost">Restaurar</button>
      </div>
    </div>
  </section>

</main>
<!-- üî• Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js"></script>

<script>
  // Configuraci√≥n de tu proyecto
  const firebaseConfig = {
    apiKey: "AIzaSyC5w6I_hK3f-Nz0Mp09Or3VESmaD_c5dm0",
    authDomain: "arslan-pro-kiwi.firebaseapp.com",
    databaseURL: "https://arslan-pro-kiwi-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "arslan-pro-kiwi",
    storageBucket: "arslan-pro-kiwi.firebasestorage.app",
    messagingSenderId: "768704045481",
    appId: "1:768704045481:web:c60aabc3cd0296f0ec772f",
    measurementId: "G-6SL4D9QXY9"
  };

  // Inicializaci√≥n global de Firebase
  firebase.initializeApp(firebaseConfig);
</script>

<!-- Tu app principal -->
<script src="app.js"></script>

<script src="app.js"></script>
</body>
</html>
